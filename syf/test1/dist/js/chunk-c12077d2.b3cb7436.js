(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-c12077d2"],{"003e":function(t,e,i){},"0421":function(t,e,i){},"615c":function(t,e,i){"use strict";var o=i("0421");i.n(o).a},"6e4e":function(t,e,i){"use strict";var o=(i("a481"),i("4917"),i("bd86")),s=(i("7f7f"),function(){var i=this,t=i.$createElement,o=i._self._c||t;return o("div",{staticClass:"m-chat-emoji"},[o("div",{staticClass:"emoji-content"},[o("div",{staticClass:"cnt"},i._l(i.currEmoji.list,function(e){return o("span",{staticClass:"emoji-item",class:{"pinup-item":"pinup"===e.type},on:{click:function(t){return t.stopPropagation(),i.selectEmoji(e)}}},[o("img",{attrs:{src:e.img}})])}),0)]),o("div",{staticClass:"emoji-channel"},[i._l(i.emoji,function(e){return o("span",{staticClass:"emoji-album",class:{active:e.name==i.currAlbum},on:{click:function(t){return t.stopPropagation(),i.selectAlbum(e)}}},[o("img",{attrs:{src:e.album}})])}),i._l(i.pinup,function(e){return"session"===i.type?o("span",{staticClass:"emoji-album",class:{active:e.name==i.currAlbum},on:{click:function(t){return t.stopPropagation(),i.selectAlbum(e)}}},[o("img",{attrs:{src:e.album}})]):i._e()})],2)])}),n=i("a850");function r(t,e){var i={};for(var o in e){var s=e[o],n=[];for(var r in s)n.push({type:t,name:o,key:r,img:s[r].img});0<n.length&&(i[o]={type:t,name:o,list:n,album:n[0].img})}return i}var c,a={props:{type:String,scene:String,to:String},data:function(){return{currType:"emoji",currAlbum:"emoji"}},computed:{emoji:function(){return r("emoji",n.a.emojiList)},pinup:function(){return r("pinup",n.a.pinupList)},currEmoji:function(){return"emoji"===this.currType?this.emoji[this.currAlbum]:"pinup"===this.currType?this.pinup[this.currAlbum]:[]}},methods:{selectAlbum:function(t){this.currType=t.type,this.currAlbum=t.name},selectEmoji:function(t){"emoji"===this.currType?this.$emit("add-emoji",t.key):"pinup"===this.currType&&("session"===this.type?this.$store.dispatch("sendMsg",{type:"custom",scene:this.scene,to:this.to,pushContent:"[贴图表情]",content:{type:3,data:{catalog:this.currAlbum,chartlet:t.key}}}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomMsg",{type:"custom",pushContent:"[贴图表情]",content:{type:3,data:{catalog:this.currAlbum,chartlet:t.key}}}),this.$emit("hide-emoji"))}}},d=(i("615c"),i("2877")),u=Object(d.a)(a,s,[],!1,null,null,null).exports,h=(i("ed08"),i("f61f")),l=i("5def"),m=i("b970"),p={components:(c={ChatEmoji:u},Object(o.a)(c,m.b.name,m.b),Object(o.a)(c,m.c.name,m.c),c),updated:function(){var t=this;window.document.body.addEventListener("click",function(){t.isEmojiShown=!1})},props:{type:String,scene:String,to:String,isRobot:{type:Boolean,default:function(){return!1}},invalid:{type:Boolean,default:!1},invalidHint:{type:String,default:"您无权限发送消息"},advancedTeam:{type:Boolean,default:!1}},watch:{continueRobotAccid:function(t,e){t&&this.robotInfos[t]&&(this.msgToSent="@".concat(this.robotInfos[t].nick," ")),this.$store.dispatch("continueRobotMsg","")},msgToSent:function(t,e){if(!this.isRobot){var i=this.msgToSent.indexOf("@");0<=i&&i===this.msgToSent.length-1?this.robotslist&&0<this.robotslist.length&&(this.isRobotListShown=!0):!0===this.isRobotListShown&&(this.isRobotListShown=!1)}}},data:function(){var e={isEmojiShown:!1,isRobotListShown:!1,msgToSent:"",icon1:"".concat(h.a.resourceUrl,"/im/chat-editor-1.png"),icon2:"".concat(h.a.resourceUrl,"/im/chat-editor-2.png"),icon3:"".concat(h.a.resourceUrl,"/im/chat-editor-3.png"),icon4:"https://yx-web-nosdn.netease.im/quickhtml%2Fassets%2Fyunxin%2Fdefault%2Fchat-editor-keyboard.png",icon5:"https://yx-web-nosdn.netease.im/quickhtml%2Fassets%2Fyunxin%2Fdefault%2Fchat-editor-record.png",sendTxt:!0,recording:!1,recordDisable:!1,toRecordCount:0,recordTime:0,$recordTime:null,recordTimeout:"",recorder:null,audioContext:null};try{e.audioContext=new window.AudioContext}catch(t){e.recordDisable=!0}return e},computed:{continueRobotAccid:function(){return this.$store.state.continueRobotAccid},robotslist:function(){return this.$store.state.robotslist},robotInfos:function(){return this.$store.state.robotInfos},robotInfosByNick:function(){return this.$store.state.robotInfosByNick},supportTouch:function(){return"ontouchend"in document&&"ontouchstart"in document&&"ontouchmove"in document}},methods:{sendTextMsg:function(){if(this.invalid)this.$toast(this.invalidHint);else if(/^\s*$/.test(this.msgToSent))this.$vux.alert.show({title:"请不要发送空消息"});else if(800<this.msgToSent.length)this.$vux.alert.show({title:"请不要超过800个字"});else{if(this.msgToSent=this.msgToSent.trim(),"session"===this.type)if(this.isRobot)this.$store.dispatch("sendRobotMsg",{type:"text",scene:this.scene,to:this.to,robotAccid:this.to,content:this.msgToSent,body:this.msgToSent});else{var t="",e="",i=this.msgToSent.match(/@[^\s@$]+/g);if(i)for(var o=0;o<i.length;o++){var s=i[o].replace("@","");if(this.robotInfosByNick[s]){t=this.robotInfosByNick[s].account,e=(this.msgToSent+"").replace(i[o],"").trim();break}}t?e?this.$store.dispatch("sendRobotMsg",{type:"text",scene:this.scene,to:this.to,robotAccid:t,content:e,body:this.msgToSent}):this.$store.dispatch("sendRobotMsg",{type:"welcome",scene:this.scene,to:this.to,robotAccid:t,body:this.msgToSent}):this.$store.dispatch("sendMsg",{type:"text",scene:this.scene,to:this.to,text:this.msgToSent})}else if("chatroom"===this.type){var n="",r="",c=this.msgToSent.match(/@[^\s@$]+/g);if(c)for(var a=0;a<c.length;a++){var d=c[a].replace("@","");if(this.robotInfosByNick[d]){n=this.robotInfosByNick[d].account,r=(this.msgToSent+"").replace(c[a],"").trim();break}}n?r?this.$store.dispatch("sendChatroomRobotMsg",{type:"text",robotAccid:n,content:r,body:this.msgToSent}):this.$store.dispatch("sendChatroomRobotMsg",{type:"welcome",robotAccid:n,body:this.msgToSent}):this.$store.dispatch("sendChatroomMsg",{type:"text",text:this.msgToSent})}this.msgToSent=""}},sendPlayMsg:function(){this.invalid?this.$toast(this.invalidHint):"session"===this.type?this.$store.dispatch("sendMsg",{type:"custom",scene:this.scene,to:this.to,pushContent:"[猜拳]",content:{type:1,data:{value:Math.ceil(3*Math.random())}}}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomMsg",{type:"custom",pushContent:"[猜拳]",content:{type:1,data:{value:Math.ceil(3*Math.random())}}})},sendFileMsg:function(){if(this.invalid)this.$toast(this.invalidHint);else{var t=this.$refs.fileToSent;t.value&&("session"===this.type?this.$store.dispatch("sendFileMsg",{scene:this.scene,to:this.to,fileInput:t}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomFileMsg",{fileInput:t}))}},showEmoji:function(){this.isEmojiShown=!0},hideEmoji:function(){this.isEmojiShown=!1},addEmoji:function(t){this.msgToSent+=t,this.hideEmoji()},chooseRobot:function(t){if(t&&t.account){var e=this.msgToSent.length;0!==e&&"@"===this.msgToSent[e-1]||(this.msgToSent+="@"+t.nick+" "),this.msgToSent+=t.nick+" "}},hideRobotList:function(){this.isRobotListShown=!1},onInputFocus:function(t){setTimeout(function(){t.target.scrollIntoView(),l.a.scrollChatListDown()},200)},turnToMsgReceipt:function(){this.invalid?this.$toast(this.invalidHint):location="#/teamSendMsgReceipt/".concat(this.to)},swicthMsgType:function(){this.sendTxt=!this.sendTxt},toRecord:function(){var i=this;if(i.toRecordCount++,window.stopPlayAudio&&window.stopPlayAudio(),"http:"!==location.protocol){if(!i.recording)if(1<i.toRecordCount&&!i.recorder&&(i.recordDisable=!0),!i.recordDisable&&i.audioContext&&window.AudioContext&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)if(i.recorder)i.recorder.record(),i.resumeAudioContext();else{var o=function(){i.recordDisable=!0,i.$toast("当前浏览器不支持录音")};try{navigator.mediaDevices.getUserMedia({audio:!0}).then(function(t){var e;try{e=i.audioContext.createMediaStreamSource(t),i.recorder=new Recorder(e),i.recorder.record(),i.resumeAudioContext(),i.recorder||o()}catch(t){o()}}).catch(function(t){i.$toast("没有权限获取麦克风"),i.recordDisable=!0})}catch(t){o()}}else i.$toast("当前浏览器不支持录音")}else i.$toast("请使用https协议")},runRecorderTime:function(){var t=this;this.recorder&&(this.recording=!0,this.recordTime=0,setTimeout(function(){t.$recordTime=document.getElementById("recordTime")},800),this.recordTimeout=setTimeout(this.runRecordDuration.bind(this),1e3))},resumeAudioContext:function(){var t=this;this.audioContext&&~this.audioContext.state.indexOf("suspend")?this.audioContext.resume().then(function(){t.recorder.record(),t.runRecorderTime()}):this.runRecorderTime()},runRecordDuration:function(){this.recordTimeout=setTimeout(this.runRecordDuration.bind(this),1e3),this.recordTime++,60<=this.recordTime&&(clearTimeout(this.recordTimeout),this.sendRecord()),this.$recordTime.innerText="00:"+(9<this.recordTime?this.recordTime:"0"+this.recordTime)},siwtchRecord:function(){this.recording?this.sendRecordMsg():this.toRecord()},cancelRecord:function(){this.recording&&(this.recording=!1,clearTimeout(this.recordTimeout),this.$recordTime&&(this.$recordTime.innerText="00:00"),this.recorder.stop(),this.recorder.clear())},sendRecordMsg:function(){setTimeout(this.sendRecord,500)},sendRecord:function(){var e=this;if(this.recording){if(clearTimeout(this.recordTimeout),this.recordTime<2)return this.$toast("语音消息最短2s"),void this.cancelRecord();this.recording=!1,this.$recordTime.innerText="00:00",this.recorder.stop(),this.recorder.exportWAV(function(t){e.$store.dispatch("showLoading"),e.$store.dispatch("sendFileMsg",{scene:e.scene,to:e.to,type:"audio",blob:t,uploadprogress:function(t){100===t.percentage&&e.$store.dispatch("hideLoading")},uploaderror:function(){console},uploaddone:function(t,e){}})}),this.recorder.clear()}}}},g=(i("6ef0"),Object(d.a)(p,function(){var i=this,t=i.$createElement,o=i._self._c||t;return o("div",{staticClass:"m-chat-editor",on:{click:i.hideRobotList}},[o("chat-emoji",{directives:[{name:"show",rawName:"v-show",value:i.isEmojiShown,expression:"isEmojiShown"}],attrs:{type:i.type,scene:i.scene,to:i.to},on:{"add-emoji":i.addEmoji,"hide-emoji":i.hideEmoji}}),o("van-cell-group",{directives:[{name:"show",rawName:"v-show",value:i.isRobotListShown,expression:"isRobotListShown"}],staticClass:"m-chat-emoji m-chat-robot"},i._l(i.robotslist,function(e){return o("van-cell",{key:e.account,attrs:{title:e.nick},nativeOn:{click:function(t){return i.chooseRobot(e)}}},[o("img",{staticClass:"icon u-circle",attrs:{slot:"icon",width:"20",height:"20",src:e.avatar},slot:"icon"})])}),1),o("div",{staticClass:"m-chat-editor-main",class:{robot:i.isRobot}},[o("span",{staticClass:"u-editor-input"},[i.sendTxt?o("textarea",{directives:[{name:"model",rawName:"v-model",value:i.msgToSent,expression:"msgToSent"}],domProps:{value:i.msgToSent},on:{focus:i.onInputFocus,input:function(t){t.target.composing||(i.msgToSent=t.target.value)}}}):i._e(),i.supportTouch&&!i.sendTxt?o("i",{directives:[{name:"touch",rawName:"v-touch:swipeup",value:i.cancelRecord,expression:"cancelRecord",arg:"swipeup"}],staticClass:"u-btn-record",class:{recording:i.recording,disabled:i.recordDisable},on:{touchstart:function(t){return t.preventDefault(),i.toRecord(t)},touchend:function(t){return t.preventDefault(),i.sendRecordMsg(t)}}},[i.recording?o("b",[i._v("松开结束")]):o("b",[i._v("按下说话")]),i.recording?o("a",{staticClass:"u-record-time",attrs:{id:"recordTime"}},[i._v("00:00")]):i._e()]):i._e(),i.supportTouch||i.sendTxt?i._e():o("i",{staticClass:"u-btn-record",class:{recording:i.recording,disabled:i.recordDisable},on:{click:function(t){return t.stopPropagation(),i.siwtchRecord(t)}}},[i.recording?o("b",[i._v("点击发送")]):o("b",[i._v("点击说话")]),i.recording?o("a",{staticClass:"u-record-time with-close-btn",attrs:{id:"recordTime"},on:{click:function(t){return t.stopPropagation(),i.cancelRecord(t)}}},[i._v("00:00")]):i._e()])]),o("span",{staticClass:"u-editor-icons ChatEditor-rightBox"},[i.sendTxt?o("span",{staticClass:"u-editor-icon",on:{click:function(t){return t.stopPropagation(),i.swicthMsgType(t)}}},[o("i",{staticClass:"u-icon-img"},[o("img",{attrs:{src:i.icon5}})])]):o("span",{staticClass:"u-editor-icon",on:{click:function(t){return t.stopPropagation(),i.swicthMsgType(t)}}},[o("i",{staticClass:"u-icon-img"},[o("img",{attrs:{src:i.icon4}})])]),i.isRobot?i._e():o("span",{staticClass:"u-editor-icon",on:{click:function(t){return t.stopPropagation(),i.showEmoji(t)}}},[o("i",{staticClass:"u-icon-img"},[o("img",{attrs:{src:i.icon1}})])]),i.isRobot?i._e():o("span",{staticClass:"u-editor-icon"},[o("i",{staticClass:"u-icon-img"},[o("img",{attrs:{src:i.icon2}})]),o("input",{ref:"fileToSent",attrs:{type:"file"},on:{change:i.sendFileMsg}})]),i.isRobot||i.advancedTeam?i._e():o("span",{staticClass:"u-editor-icon",on:{click:function(t){return t.stopPropagation(),i.sendPlayMsg(t)}}},[o("i",{staticClass:"u-icon-img"},[o("img",{attrs:{src:i.icon3}})])]),i.advancedTeam?o("span",{staticClass:"u-editor-send u-editor-receipt",on:{click:i.turnToMsgReceipt}},[i._v("回执")]):i._e(),o("span",{staticClass:"u-editor-send",on:{click:i.sendTextMsg}},[i._v("发 送")])])])],1)},[],!1,null,null,null));e.a=g.exports},"6ef0":function(t,e,i){"use strict";var o=i("003e");i.n(o).a}}]);