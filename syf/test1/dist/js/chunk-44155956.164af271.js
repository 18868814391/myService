(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-44155956"],{"2ae8":function(t,e,s){"use strict";var a=s("9f68"),r=s.n(a);r.a},"9f68":function(t,e,s){},a78b:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"g-inherit m-article"},[s("x-header",{staticClass:"m-tab",attrs:{"left-options":{backText:" "}}},[s("button-tab",{staticClass:"m-tab-top",model:{value:t.sysType,callback:function(e){t.sysType=e},expression:"sysType"}},[s("button-tab-item",{staticClass:"u-tab-top"},[t._v("系统消息")]),s("button-tab-item",{staticClass:"u-tab-top"},[t._v("自定义消息")])],1),s("a",{attrs:{slot:"left"},slot:"left"}),s("a",{attrs:{slot:"right"},on:{click:function(e){return e.stopPropagation(),t.clearMsgs(e)}},slot:"right"},[t._v("清空")])],1),s("div",{staticClass:"m-article-main p-sysmsgs"},[s("group",{staticClass:"u-list"},[t._l(t.msgList,function(e){return["applyTeam"===e.type||"teamInvite"===e.type?s("cell",{directives:[{name:"touch",rawName:"v-touch:swipeleft",value:t.showDelBtn,expression:"showDelBtn",arg:"swipeleft"},{name:"touch",rawName:"v-touch:swiperight",value:t.hideDelBtn,expression:"hideDelBtn",arg:"swiperight"}],key:e.idServer,staticClass:"u-list-item",attrs:{idServer:e.idServer}},[s("img",{staticClass:"icon",attrs:{slot:"icon",width:"24",src:e.avatar},slot:"icon"}),s("div",{staticClass:"g-teamSys",attrs:{slot:"child"},slot:"child"},[s("div",{staticClass:"m-info"},[s("span",{staticClass:"u-name"},[t._v(t._s(e.from))]),s("span",{staticClass:"u-time"},[t._v(t._s(e.showTime))]),s("p",{staticClass:"u-desc"},[t._v(t._s(e.desc))]),e.ps?s("p",{staticClass:"u-desc"},[t._v(t._s("留言:"+e.ps))]):t._e()]),t.deleteIdServer!==e.idServer?s("div",{staticClass:"m-options",attrs:{slot:"default"},slot:"default"},["init"===e.state?[s("x-button",{attrs:{type:"primary",mini:!0,"action-type":"button"},nativeOn:{click:function(s){return t.handleTeamApply(e,!0)}}},[t._v("同意")]),s("x-button",{attrs:{type:"warn",mini:!0,"action-type":"button"},nativeOn:{click:function(s){return t.handleTeamApply(e,!1)}}},[t._v("拒绝")])]:s("div",{staticClass:"u-msg-state"},[t._v("\n                "+t._s("error"===e.state?"已过期":"rejected"===e.state?"已拒绝":"已同意")+"\n              ")])],2):t._e()]),s("span",{staticClass:"u-tag-del",class:{active:t.deleteIdServer===e.idServer},on:{click:function(s){return t.deleteMsg(e.idServer)}}})]):s("cell",{directives:[{name:"touch",rawName:"v-touch:swipeleft",value:t.showDelBtn,expression:"showDelBtn",arg:"swipeleft"},{name:"touch",rawName:"v-touch:swiperight",value:t.hideDelBtn,expression:"hideDelBtn",arg:"swiperight"}],key:e.idServer,staticClass:"u-list-item",attrs:{title:e.showText,value:e.showTime,"inline-desc":e.desc,idServer:e.idServer}},[s("img",{staticClass:"icon",attrs:{slot:"icon",width:"24",src:e.avatar},slot:"icon"}),s("span",{staticClass:"u-tag-del",class:{active:t.deleteIdServer===e.idServer},on:{click:function(s){return t.deleteMsg(e.idServer)}}})])]})],2),!t.msgList||t.msgList.length<1?s("div",{staticClass:"empty-hint"},[t._v("暂无任何消息")]):t._e()],1)],1)},r=[],i=(s("7514"),s("55dd"),s("7f7f"),s("f61f")),n={mounted:function(){this.$store.dispatch("markSysMsgRead"),this.$store.dispatch("markCustomSysMsgRead")},updated:function(){this.$store.dispatch("markSysMsgRead"),this.$store.dispatch("markCustomSysMsgRead")},data:function(){return{sysType:0,defaultAvatar:i["a"].defaultUserIcon,deleteIdServer:""}},computed:{userInfos:function(){return this.$store.state.userInfos||{}},sysMsgs:function(){var t=this,e=this.$store.state.sysMsgs.filter(function(e){switch(e.type){case"addFriend":return e.showText="".concat(e.friend.alias||e.friend.account," 添加您为好友~"),e.avatar=t.userInfos[e.from]&&t.userInfos[e.from].avatar,!0;case"deleteFriend":return e.showText="".concat(e.from," 将您从好友中删除"),e.avatar=t.userInfos[e.from].avatar,!1;case"applyTeam":return console.log("applyTeam",e),e.showText=e.from,e.avatar=t.userInfos[e.from]&&t.userInfos[e.from].avatar||t.defaultAvatar,e.desc="申请加入群:".concat(t.getTeamName(e.to)),!0;case"teamInvite":return e.showText=e.attach.team.name,e.avatar=t.userInfos[e.from]&&t.userInfos[e.from].avatar||t.defaultAvatar,e.desc="邀请你加入群".concat(e.to),!0;case"rejectTeamApply":return e.showText=e.attach.team.name,e.desc="管理员拒绝你加入本群",e.avatar=e.attach.team.avatar||t.defaultAvatar,!0;case"rejectTeamInvite":var s=t.userInfos[e.from];return e.showText=s.nick,e.avatar=s.avatar||t.defaultAvatar,e.desc="".concat(s.nick,"拒绝了群").concat(t.getTeamName(e.to),"的入群邀请"),!0}return console.log(e),!1});return e.sort(function(t,e){return e.time-t.time}),e},customSysMsgs:function(){var t=this,e=this.$store.state.customSysMsgs.filter(function(e){if("p2p"===e.scene){var s=JSON.parse(e.content);return e.showText="".concat(s.content),e.avatar=t.userInfos[e.from].avatar,e}return!1});return e},msgList:function(){return 0===this.sysType?this.sysMsgs:this.customSysMsgs}},methods:{deleteMsg:function(t){this.$store.commit("deleteSysMsgs",{type:this.sysType,idServer:t})},clearMsgs:function(){var t=this;this.$vux.confirm.show({title:"确认要清空消息吗？",onConfirm:function(){t.$store.dispatch("resetSysMsgs",{type:t.sysType})}})},getTeamName:function(t){var e=this.$store.state.teamlist.find(function(e){return e.teamId===t});return e&&e.name||""},handleTeamApply:function(t,e){var s;switch(t.type){case"applyTeam":s=e?"passTeamApply":"rejectTeamApply";break;case"teamInvite":s=e?"acceptTeamInvite":"rejectTeamInvite";break;default:return}this.$store.dispatch("delegateTeamFunction",{functionName:s,options:{idServer:t.idServer,teamId:t.to,from:t.from,done:function(t,e){console.log("handleDone",e)}}})},findTeamInfo:function(t){var e=this.$store.state.teamlist.find(function(e){return e.teamId===t});return e&&e.name||t},showDelBtn:function(t){var e=this;t&&t.data&&t.data.attrs&&(this.deleteIdServer=t.data.attrs.idServer,this.stopBubble=!0,setTimeout(function(){e.stopBubble=!1},20))},hideDelBtn:function(){return null!==this.deleteIdServer&&!this.stopBubble&&(this.deleteIdServer=null,!0)}}},o=n,c=(s("2ae8"),s("2877")),l=Object(c["a"])(o,a,r,!1,null,null,null);e["default"]=l.exports}}]);
//# sourceMappingURL=chunk-44155956.164af271.js.map