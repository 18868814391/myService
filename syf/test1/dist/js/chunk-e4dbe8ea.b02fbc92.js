(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e4dbe8ea"],{"47e4":function(e,t,i){"use strict";var o=i("b50c"),s=i.n(o);s.a},"49b2":function(e,t,i){},7856:function(e,t,i){"use strict";var o=i("49b2"),s=i.n(o);s.a},a850:function(e,t,i){"use strict";i("f61f");var o="http://yx-web.nosdn.127.net/webdoc/h5/emoji",s={emoji:{"[大笑]":{file:"emoji_0.png"},"[可爱]":{file:"emoji_01.png"},"[色]":{file:"emoji_02.png"},"[嘘]":{file:"emoji_03.png"},"[亲]":{file:"emoji_04.png"},"[呆]":{file:"emoji_05.png"},"[口水]":{file:"emoji_06.png"},"[汗]":{file:"emoji_145.png"},"[呲牙]":{file:"emoji_07.png"},"[鬼脸]":{file:"emoji_08.png"},"[害羞]":{file:"emoji_09.png"},"[偷笑]":{file:"emoji_10.png"},"[调皮]":{file:"emoji_11.png"},"[可怜]":{file:"emoji_12.png"},"[敲]":{file:"emoji_13.png"},"[惊讶]":{file:"emoji_14.png"},"[流感]":{file:"emoji_15.png"},"[委屈]":{file:"emoji_16.png"},"[流泪]":{file:"emoji_17.png"},"[嚎哭]":{file:"emoji_18.png"},"[惊恐]":{file:"emoji_19.png"},"[怒]":{file:"emoji_20.png"},"[酷]":{file:"emoji_21.png"},"[不说]":{file:"emoji_22.png"},"[鄙视]":{file:"emoji_23.png"},"[阿弥陀佛]":{file:"emoji_24.png"},"[奸笑]":{file:"emoji_25.png"},"[睡着]":{file:"emoji_26.png"},"[口罩]":{file:"emoji_27.png"},"[努力]":{file:"emoji_28.png"},"[抠鼻孔]":{file:"emoji_29.png"},"[疑问]":{file:"emoji_30.png"},"[怒骂]":{file:"emoji_31.png"},"[晕]":{file:"emoji_32.png"},"[呕吐]":{file:"emoji_33.png"},"[拜一拜]":{file:"emoji_160.png"},"[惊喜]":{file:"emoji_161.png"},"[流汗]":{file:"emoji_162.png"},"[卖萌]":{file:"emoji_163.png"},"[默契眨眼]":{file:"emoji_164.png"},"[烧香拜佛]":{file:"emoji_165.png"},"[晚安]":{file:"emoji_166.png"},"[强]":{file:"emoji_34.png"},"[弱]":{file:"emoji_35.png"},"[OK]":{file:"emoji_36.png"},"[拳头]":{file:"emoji_37.png"},"[胜利]":{file:"emoji_38.png"},"[鼓掌]":{file:"emoji_39.png"},"[握手]":{file:"emoji_200.png"},"[发怒]":{file:"emoji_40.png"},"[骷髅]":{file:"emoji_41.png"},"[便便]":{file:"emoji_42.png"},"[火]":{file:"emoji_43.png"},"[溜]":{file:"emoji_44.png"},"[爱心]":{file:"emoji_45.png"},"[心碎]":{file:"emoji_46.png"},"[钟情]":{file:"emoji_47.png"},"[唇]":{file:"emoji_48.png"},"[戒指]":{file:"emoji_49.png"},"[钻石]":{file:"emoji_50.png"},"[太阳]":{file:"emoji_51.png"},"[有时晴]":{file:"emoji_52.png"},"[多云]":{file:"emoji_53.png"},"[雷]":{file:"emoji_54.png"},"[雨]":{file:"emoji_55.png"},"[雪花]":{file:"emoji_56.png"},"[爱人]":{file:"emoji_57.png"},"[帽子]":{file:"emoji_58.png"},"[皇冠]":{file:"emoji_59.png"},"[篮球]":{file:"emoji_60.png"},"[足球]":{file:"emoji_61.png"},"[垒球]":{file:"emoji_62.png"},"[网球]":{file:"emoji_63.png"},"[台球]":{file:"emoji_64.png"},"[咖啡]":{file:"emoji_65.png"},"[啤酒]":{file:"emoji_66.png"},"[干杯]":{file:"emoji_67.png"},"[柠檬汁]":{file:"emoji_68.png"},"[餐具]":{file:"emoji_69.png"},"[汉堡]":{file:"emoji_70.png"},"[鸡腿]":{file:"emoji_71.png"},"[面条]":{file:"emoji_72.png"},"[冰淇淋]":{file:"emoji_73.png"},"[沙冰]":{file:"emoji_74.png"},"[生日蛋糕]":{file:"emoji_75.png"},"[蛋糕]":{file:"emoji_76.png"},"[糖果]":{file:"emoji_77.png"},"[葡萄]":{file:"emoji_78.png"},"[西瓜]":{file:"emoji_79.png"},"[光碟]":{file:"emoji_80.png"},"[手机]":{file:"emoji_81.png"},"[电话]":{file:"emoji_82.png"},"[电视]":{file:"emoji_83.png"},"[声音开启]":{file:"emoji_84.png"},"[声音关闭]":{file:"emoji_85.png"},"[铃铛]":{file:"emoji_86.png"},"[锁头]":{file:"emoji_87.png"},"[放大镜]":{file:"emoji_88.png"},"[灯泡]":{file:"emoji_89.png"},"[锤头]":{file:"emoji_90.png"},"[烟]":{file:"emoji_91.png"},"[炸弹]":{file:"emoji_92.png"},"[枪]":{file:"emoji_93.png"},"[刀]":{file:"emoji_94.png"},"[药]":{file:"emoji_95.png"},"[打针]":{file:"emoji_96.png"},"[钱袋]":{file:"emoji_97.png"},"[钞票]":{file:"emoji_98.png"},"[银行卡]":{file:"emoji_99.png"},"[手柄]":{file:"emoji_100.png"},"[麻将]":{file:"emoji_101.png"},"[调色板]":{file:"emoji_102.png"},"[电影]":{file:"emoji_103.png"},"[麦克风]":{file:"emoji_104.png"},"[耳机]":{file:"emoji_105.png"},"[音乐]":{file:"emoji_106.png"},"[吉他]":{file:"emoji_107.png"},"[火箭]":{file:"emoji_108.png"},"[飞机]":{file:"emoji_109.png"},"[火车]":{file:"emoji_110.png"},"[公交]":{file:"emoji_111.png"},"[轿车]":{file:"emoji_112.png"},"[出租车]":{file:"emoji_113.png"},"[警车]":{file:"emoji_114.png"},"[自行车]":{file:"emoji_115.png"}}};for(var n in s){var a=s[n];for(var l in a){var m=a[l];m.img="".concat(o,"/").concat(n,"/").concat(m.file)}}for(var r={ajmd:{},xxy:{},lt:{}},g=1;g<=48;g++){var f="ajmd0"+(g>=10?g:"0"+g);r["ajmd"][f]={file:f+".png"}}for(var p=1;p<=40;p++){var c="xxy0"+(p>=10?p:"0"+p);r["xxy"][c]={file:c+".png"}}for(var u=1;u<=20;u++){var d="lt0"+(u>=10?u:"0"+u);r["lt"][d]={file:d+".png"}}for(var _ in r){var h=r[_];for(var j in h){var y=h[j];y.img="".concat(o,"/").concat(_,"/").concat(y.file)}}t["a"]={emojiList:s,pinupList:r}},b50c:function(e,t,i){},ef1a:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",{staticClass:"m-chat-list p-chat-list",attrs:{id:"chat-list"}},[e.canLoadMore?i("li",{staticClass:"u-msg item-time"},[e._v("\n    ---- 上拉加载更多 ----\n  ")]):i("li",{staticClass:"u-msg item-time"},[e._v("\n    ---- 已无更多记录 ----\n  ")]),e._l(e.msglist,function(t,o){return i("chat-item",{key:t.idClient||o,attrs:{type:e.type,rawMsg:t,isRobot:e.isRobot,userInfos:e.userInfos,myInfo:e.myInfo,isHistory:e.isHistory},on:{"msg-loaded":e.msgLoaded}})})],2)},s=[],n=i("ed08"),a=i("f61f"),l=i("a850"),m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("li",{staticClass:"u-msg",class:{"item-me":"out"===e.msg.flow,"item-you":"in"===e.msg.flow,"item-time":"timeTag"===e.msg.type,"item-tip":"tip"===e.msg.type,"session-chat":"session"===e.type}},["timeTag"===e.msg.type?i("div",[e._v("---- "+e._s(e.msg.showText)+" ----")]):"tip"===e.msg.type?i("div",{staticClass:"tip"},[e._v(e._s(e.msg.showText))]):"notification"===e.msg.type&&"team"===e.msg.scene?i("div",{staticClass:"notification"},[e._v(e._s(e.msg.showText))]):"in"===e.msg.flow||"out"===e.msg.flow?i("div",{directives:[{name:"touch",rawName:"v-touch:hold",value:e.revocateMsg,expression:"revocateMsg",arg:"hold"}],attrs:{idClient:e.msg.idClient,time:e.msg.time,flow:e.msg.flow,type:e.msg.type}},[e.msg.avatar?i("a",{staticClass:"msg-head",attrs:{href:e.msg.link}},[i("img",{staticClass:"icon u-circle",attrs:{src:e.msg.avatar}})]):"notification"!==e.msg.type?i("p",{staticClass:"msg-user"},[i("em",[e._v(e._s(e.msg.showTime))]),e._v(e._s(e.msg.from))]):e._e(),"text"===e.msg.type?i("span",{staticClass:"msg-text",domProps:{innerHTML:e._s(e.msg.showText)}}):"custom-type1"===e.msg.type?i("span",{ref:"mediaMsg",staticClass:"msg-text"}):"custom-type3"===e.msg.type?i("span",{ref:"mediaMsg",staticClass:"msg-text"}):"image"===e.msg.type?i("span",{ref:"mediaMsg",staticClass:"msg-text",on:{click:function(t){return t.stopPropagation(),e.showFullImg(e.msg.originLink)}}}):"video"===e.msg.type?i("span",{ref:"mediaMsg",staticClass:"msg-text"}):"audio"===e.msg.type?i("span",{staticClass:"msg-text msg-audio",class:{unreadAudio:e.msg.unreadAudio},style:"width: "+e.msg.width,domProps:{innerHTML:e._s(e.msg.showText)},on:{click:function(t){return e.playAudio(e.msg,t)}}}):"file"===e.msg.type?i("span",{staticClass:"msg-text"},[i("a",{attrs:{href:e.msg.fileLink,target:"_blank"}},[i("i",{staticClass:"u-icon icon-file"}),e._v(e._s(e.msg.showText))])]):"robot"===e.msg.type?i("span",{staticClass:"msg-text",class:{"msg-robot":"out"!==e.msg.robotFlow&&!e.isRobot}},["out"===e.msg.robotFlow?i("div",[e._v(e._s(e.msg.showText))]):"bot"===e.msg.subType?i("div",e._l(e.msg.message,function(t){return i("div",e._l(t,function(t){return i("div",["text"===t.type?i("div",[i("p",[e._v(e._s(t.text))])]):"image"===t.type?i("div",[i("p",[i("img",{attrs:{src:t.url}})])]):"url"===t.type?i("div",[i("a",{class:t.style,attrs:{href:t.target,target:"_blank"}},[t.image?i("div",e._l(t.image,function(e){return i("p",[i("img",{attrs:{src:e.url}})])}),0):e._e(),t.text?i("div",e._l(t.text,function(t){return i("p",[e._v(e._s(t.text))])}),0):e._e()])]):"block"===t.type?i("div",[i("a",{class:t.style,attrs:{params:t.params,target:t.target},on:{click:function(i){return e.sendRobotBlockMsg(t,e.msg)}}},[t.image?i("div",e._l(t.image,function(e){return i("p",[i("img",{attrs:{src:e.url}})])}),0):e._e(),t.text?i("div",e._l(t.text,function(t){return i("p",[e._v(e._s(t.text))])}),0):e._e()])]):e._e()])}),0)}),0):"faq"===e.msg.subType?i("div",[i("p",[e._v(e._s(e.msg.message.answer))])]):e._e(),"out"===e.msg.robotFlow||e.isRobot?e._e():i("span",{staticClass:"msg-link"},[i("a",{staticClass:"link-right",on:{click:function(t){return e.continueRobotMsg(e.msg.content.robotAccid)}}},[e._v("继续对话")])])]):"notification"===e.msg.type?i("span",{staticClass:"msg-text notify"},[e._v(e._s(e.msg.showText))]):i("span",{staticClass:"msg-text",domProps:{innerHTML:e._s(e.msg.showText)}}),"fail"===e.msg.status?i("span",{staticClass:"msg-failed"},[i("i",{staticClass:"weui-icon-warn"})]):e._e(),e.teamMsgUnRead>=0?i("a",{staticClass:"msg-unread",attrs:{href:"#/msgReceiptDetail/"+e.msg.to+"-"+e.msg.idServer}},[e._v(e._s(e.teamMsgUnRead>0?e.teamMsgUnRead+"人未读":"全部已读"))]):e._e()]):e._e()])},r=[],g=(i("55dd"),i("a481"),i("ac6a"),i("4917"),i("5176")),f=i.n(g),p=(i("7f7f"),i("e814")),c=i.n(p),u=(i("7514"),{$node:null,$audio:null,timeout:"",imgPlay0:"https://yx-web-nosdn.netease.im/quickhtml%2Fassets%2Fyunxin%2Fdefault%2Fplay0.gif",imgPlay1:"https://yx-web-nosdn.netease.im/quickhtml%2Fassets%2Fyunxin%2Fdefault%2Fplay1.gif"}),d={props:{type:String,rawMsg:{type:Object,default:function(){return{}}},userInfos:{type:Object,default:function(){return{}}},myInfo:{type:Object,default:function(){return{}}},isRobot:{type:Boolean,default:function(){return!1}},isHistory:{type:Boolean,default:function(){return!1}}},data:function(){return{msg:"",isFullImgShow:!1}},computed:{robotInfos:function(){return this.$store.state.robotInfos},teamMsgUnRead:function(){var e=this,t=!this.isHistory&&this.msg.needMsgReceipt&&"out"===this.msg.flow&&this.$store.state.teamMsgReads.find(function(t){return t.idServer===e.msg.idServer});return t?c()(t.unread):-1}},watch:{rawMsg:function(e,t){var i=e&&e.localCustom;if(i&&e&&"audio"===e.type){var o=t&&t.localCustom;i!==o&&this.computedItem()}}},beforeMount:function(){this.computedItem()},mounted:function(){var e=this,t=this.msg;window.stopPlayAudio=this.stopPlayAudio.bind(this),this.$nextTick(function(){var i=null;if("image"===t.type)i=new Image,i.src=t.file.url+"?imageView&thumbnail=180x0&quality=85";else if("custom-type1"===t.type)i=new Image,i.className="emoji-middle",i.src=t.imgUrl;else if("custom-type3"===t.type)i=new Image,i.className="emoji-big",i.src=t.imgUrl;else if("video"===t.type)if(/(mov|mp4|ogg|webm)/i.test(t.file.ext))i=document.createElement("video"),i.src=t.file.url,i.width=640,i.height=480,i.autoStart=!1,i.preload="metadata",i.controls="controls";else{var o=document.createElement("a");o.href=t.file.url,o.target="_blank",o.innerHTML='<i class="u-icon icon-file"></i>'.concat(video.name),e.$refs.mediaMsg.appendChild(o)}i?(e.$refs.mediaMsg&&e.$refs.mediaMsg.appendChild(i),i.onload=function(){e.$emit("msg-loaded")},i.onerror=function(){e.$emit("msg-loaded")}):e.$emit("msg-loaded")})},methods:{computedItem:function(){var e=f()({},this.rawMsg);if("session"===this.type)if("in"===e.flow)if("robot"===e.type&&e.content&&e.content.msgOut){var t=e.content.robotAccid;e.avatar=this.robotInfos[t].avatar,e.isRobot=!0,e.link="#/namecard/".concat(t)}else e.from!==this.$store.state.userUID?(e.avatar=this.userInfos[e.from]&&this.userInfos[e.from].avatar||a["a"].defaultUserIcon,e.link="#/namecard/".concat(e.from)):e.avatar=this.myInfo.avatar;else"out"===e.flow&&(e.avatar=this.myInfo.avatar);else e.showTime=n["a"].formatDate(e.time);if("timeTag"===e.type)e.showText=e.text;else if("text"===e.type){if(e.showText=n["a"].escape(e.text),/\[[^\]]+\]/.test(e.showText)){var i=e.showText.match(/\[[^\]]+\]/g);i.forEach(function(t){var i=l["a"].emojiList.emoji;i[t]&&(e.showText=e.showText.replace(t,'<img class="emoji-small" src="'.concat(i[t].img,'">')))})}}else if("custom"===e.type){var o=JSON.parse(e.content);if(1===o.type){var s=o.data,m=a["a"].resourceUrl;e.type="custom-type1",e.imgUrl="".concat(m,"/im/play-").concat(s.value,".png")}else if(3===o.type){var r=o.data,g="";l["a"].pinupList[r.catalog]&&(g=l["a"].pinupList[r.catalog][r.chartlet],e.type="custom-type3",e.imgUrl="".concat(g.img))}else e.showText=n["a"].parseCustomMsg(e),"[自定义消息]"!==e.showText&&(e.showText+=",请到手机或电脑客户端查看")}else if("image"===e.type)e.originLink=e.file.url;else if("video"===e.type);else if("audio"===e.type)e.width=(5.3+.03*Math.round(e.file.dur/1e3)).toFixed(2)+"rem",e.audioSrc=e.file.mp3Url,e.showText="<i>"+Math.round(e.file.dur/1e3)+'"</i> 点击播放',!this.isHistory&&nim.useDb&&(e.unreadAudio=!e.localCustom);else if("file"===e.type)e.fileLink=e.file.url,e.showText=e.file.name;else if("notification"===e.type)"team"===e.scene?e.showText=n["a"].generateTeamSysmMsg(e):e.showText=n["a"].generateChatroomSysMsg(e);else if("tip"===e.type)e.showText=e.tip;else if("robot"===e.type){var p=e.content||{},c=p.message||[];if(p.msgOut){if("bot"===p.flag)e.subType="bot",c=c.map(function(e){return"template"===e.type?e.content.json:"text"===e.type||"answer"===e.type?[{type:"text",text:e.content}]:"image"===e.type?[{type:"image",url:e.content}]:void 0}),e.message=c;else if("faq"===e.content.flag){e.subType="faq",e.query=c.query;var u=c.match.sort(function(e,t){return t.score-e.score});e.message=u[0]}}else e.robotFlow="out",e.showText=e.text}else e.showText="[".concat(n["a"].mapMsgType(e),"],请到手机或电脑客户端查看");this.msg=e},revocateMsg:function(e){if(this.$store.state.currSessionId&&e&&e.data&&e.data.attrs){var t=e.data.attrs;if("robot"===t.type)return;if("out"===t.flow){var i=this;this.$vux.confirm.show({title:"确定需要撤回消息",onCancel:function(){},onConfirm:function(){i.$store.dispatch("revocateMsg",{idClient:t.idClient})}})}}},sendRobotBlockMsg:function(e,t){if(!this.isHistory){var i="[复杂按钮模板触发消息]";e.text&&1===e.text.length&&(i=e.text[0].text);var o=t.content.robotAccid;this.isRobot||(i="@".concat(this.robotInfos[o].nick," ").concat(i)),"session"===this.type?this.$store.dispatch("sendRobotMsg",{type:"link",scene:t.scene,to:t.to,robotAccid:o,params:e.params,target:e.target,body:i}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomRobotMsg",{type:"link",robotAccid:o,params:e.params,target:e.target,body:i})}},continueRobotMsg:function(e){this.$store.dispatch("continueRobotMsg",e)},showFullImg:function(e){this.$store.dispatch("showFullscreenImg",{src:e})},autoPlayNextUnreadAudio:function(){var e=u.$node&&u.$node.parentElement;if(e){var t,i=e.parentElement,o=i.nextElementSibling;while(o){if(~o.className.indexOf("item-you")&&(t=o.querySelector(".msg-audio"),t))break;o=o.nextElementSibling}o&&~t.className.indexOf("unreadAudio")&&t.click()}},playAudio:function(e,t){var i,o=this;if(i=~t.target.className.indexOf("msg-audio")?t.target:t.target.parentElement,u.$audio){var s=i.childNodes[2],n=s&&"IMG"===s.tagName;if(this.stopPlayAudio(),n)return}var a=e.file.dur;if(a){u.$audio=document.createElement("audio");var l=document.createElement("source"),m=e.file.ext;l.src=e.file.url,l.type="audio/"+("mp3"===m?"mpeg":m),u.$audio.appendChild(l),u.$audio.play(),u.$node=i,i.innerHTML=i.innerHTML.replace("点击播放",'<img src="'+("in"===e.flow?u.imgPlay1:u.imgPlay0)+'">'),u.timeout=setTimeout(function(){u.$audio=null,o.canclePlayAudio()},a),~u.$node.className.indexOf("unreadAudio")&&(e.localCustom='{"audio": "played"}',this.$store.dispatch("updateLocalMsg",e),u.$node.className=u.$node.className.replace("unreadAudio",""),u.$audio.onended=this.autoPlayNextUnreadAudio.bind(this))}},canclePlayAudio:function(){u.$node.childNodes[2]&&u.$node.removeChild(u.$node.childNodes[2]),u.$node.innerHTML+="点击播放"},stopPlayAudio:function(){u.$audio&&(u.$audio.pause(),this.canclePlayAudio(),clearTimeout(u.timeout),u.$audio=null,u.$node=null,u.timeout="")},toMsgUnReadDetail:function(){this.href="#/msgReceiptDetail/"+this.msg.idServer}}},_=d,h=(i("7856"),i("2877")),j=Object(h["a"])(_,m,r,!1,null,null,null),y=j.exports,v={components:{ChatItem:y},props:{type:String,canLoadMore:[String,Boolean],isRobot:{type:Boolean,default:function(){return!1}},msglist:{type:Array,default:function(){return[]}},userInfos:{type:Object,default:function(){return{}}},myInfo:{type:Object,default:function(){return{}}},isHistory:{type:Boolean,default:function(){return!1}}},data:function(){return{isFullImgShow:!1,msgLoadedTimer:null}},methods:{showFullImg:function(e){this.$store.dispatch("showFullscreenImg",{src:e})},msgLoaded:function(){var e=this;clearTimeout(this.msgLoadedTimer),this.msgLoadedTimer=setTimeout(function(){e.$emit("msgs-loaded")},20)}}},x=v,w=(i("47e4"),Object(h["a"])(x,o,s,!1,null,null,null));t["a"]=w.exports}}]);
//# sourceMappingURL=chunk-e4dbe8ea.b02fbc92.js.map