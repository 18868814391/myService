{"version":3,"sources":["webpack:///./src/view/index/chatRoom.vue?c094","webpack:///src/view/index/chatRoom.vue","webpack:///./src/view/index/chatRoom.vue?d13c","webpack:///./src/view/index/chatRoom.vue","webpack:///./src/view/index/chatRoom.vue?d794"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","num","attrs","id","_l","item","ind","key","adm","admin","Thename","_e","updataTime","content","index","on","click","$event","startVoice","voice","directives","name","rawName","value","expression","type","domProps","input","target","composing","con","show","startRecord","isRecording","send","position","model","callback","$$v","inde","selEmoj","staticRenderFns","chatRoomvue_type_script_lang_js_","components","_components","Object","defineProperty","es","data","emoji","histortist","chatList","auth","ws","hub","noAdm","localId","serverId","openVoice","signature","beforeRouteLeave","to","from","next","close","created","self","timestamp","Date","valueOf","console","log","String","substr","getlatest","WebSocket","onopen","onmessage","e","JSON","parse","push","$nextTick","msg_box","document","getElementById","scrollTop","scrollHeight","onerror","setTimeout","ddd","moment_default","format","obj","stringify_default","mounted","sessionStorage","getItem","weixin_js_sdk_default","a","config","debug","appId","nonceStr","jsApiList","onVoiceRecordEnd","complete","res","uploadVoice","isShowProgressTips","success","confirm","title","message","then","catch","methods","endAndSend","api","d","errmsg","reverse","downloadVoice","playVoice","stopRecord","index_chatRoomvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_chatRoom_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_chatRoom_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0___default","n"],"mappings":"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","file":"js/chunk-7b77d1ba.ef4d2aa2.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"chat-page\"},[_c('div',{staticClass:\"chat-page-head\"},[_vm._v(\"\\n    当前在线人数\"+_vm._s(_vm.num)+\"\\n    \")]),_c('div',{staticClass:\"chat-page-body\",attrs:{\"id\":\"msg_box\"}},[_vm._l((_vm.histortist),function(item,ind){return _c('div',{key:ind,staticClass:\"chatMsg\"},[(item.adm!=_vm.admin)?_c('div',{staticClass:\"chatMsg-t1\"},[_vm._v(_vm._s(item.Thename)+\"说：\")]):_vm._e(),(item.adm!=_vm.admin)?_c('div',{staticClass:\"chatMsg-t2\"},[_vm._v(_vm._s(item.updataTime))]):_vm._e(),(item.adm!=_vm.admin)?_c('div',{staticClass:\"chatMsg-t3\"},[_vm._v(_vm._s(item.content))]):_vm._e(),(item.adm==_vm.admin)?_c('div',{staticClass:\"chatMsg-t1 al gb\"},[_vm._v(_vm._s(item.Thename)+\"说：\")]):_vm._e(),(item.adm==_vm.admin)?_c('div',{staticClass:\"chatMsg-t2 al gb\"},[_vm._v(_vm._s(item.updataTime))]):_vm._e(),(item.adm==_vm.admin)?_c('div',{staticClass:\"chatMsg-t3 al gb\"},[_vm._v(_vm._s(item.content))]):_vm._e()])}),_c('div',{staticClass:\"historyRecord\"},[_vm._v(\"————历史纪录————\")]),_vm._l((_vm.chatList),function(item,index){return _c('div',{key:index,staticClass:\"chatMsg\"},[(item.adm!=_vm.admin)?_c('div',{staticClass:\"chatMsg-t1\"},[_vm._v(_vm._s(item.Thename)+\"说：\")]):_vm._e(),(item.adm!=_vm.admin)?_c('div',{staticClass:\"chatMsg-t2\"},[_vm._v(_vm._s(item.updataTime))]):_vm._e(),(item.adm!=_vm.admin)?_c('div',{staticClass:\"chatMsg-t3\"},[(item.content)?_c('span',[_vm._v(_vm._s(item.content))]):_vm._e(),(item.voice)?_c('span',{on:{\"click\":function($event){return _vm.startVoice(item.voice)}}},[_vm._v(\"[点击播放语音]\")]):_vm._e()]):_vm._e(),(item.adm==_vm.admin)?_c('div',{staticClass:\"chatMsg-t1 al gb\"},[_vm._v(_vm._s(item.Thename)+\"说：\")]):_vm._e(),(item.adm==_vm.admin)?_c('div',{staticClass:\"chatMsg-t2 al gb\"},[_vm._v(_vm._s(item.updataTime))]):_vm._e(),(item.adm==_vm.admin)?_c('div',{staticClass:\"chatMsg-t3 al gb\"},[(item.content)?_c('span',[_vm._v(_vm._s(item.content))]):_vm._e(),(item.voice)?_c('span',{on:{\"click\":function($event){return _vm.startVoice(item.voice)}}},[_vm._v(\"[点击播放语音]\")]):_vm._e()]):_vm._e()])})],2),_c('div',{staticClass:\"chat-page-bottom\"},[_c('textarea',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.con),expression:\"con\"}],attrs:{\"type\":\"text\",\"name\":\"\",\"id\":\"\"},domProps:{\"value\":(_vm.con)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.con=$event.target.value}}}),_c('div',{staticClass:\"sendop\"},[_c('div',{staticClass:\"sendop-b1\"},[_c('button',{on:{\"click\":function($event){_vm.show=!_vm.show}}},[_vm._v(\"颜艺\")]),_c('button',{on:{\"click\":_vm.startRecord}},[_vm._v(_vm._s(_vm.isRecording?'录音中...':'点击录音'))])]),_c('button',{on:{\"click\":_vm.send}},[_vm._v(\"发送\")])])]),_c('van-popup',{attrs:{\"position\":\"bottom\"},model:{value:(_vm.show),callback:function ($$v) {_vm.show=$$v},expression:\"show\"}},[_c('div',{staticClass:\"emojBox\"},_vm._l((_vm.emoji),function(item,inde){return _c('div',{key:inde,staticClass:\"emojBox-items\",on:{\"click\":function($event){return _vm.selEmoj(item)}}},[_vm._v(\"\\n        \"+_vm._s(item)+\"\\n      \")])}),0)])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"chat-page\">\r\n    <div class=\"chat-page-head\">\r\n      当前在线人数{{num}}\r\n      <!-- <div class=\"ttips\"></div> -->\r\n    </div>\r\n    <div class=\"chat-page-body\" id=\"msg_box\">\r\n      <div v-for=\"(item,ind) in histortist\" :key=\"ind\" class=\"chatMsg\">\r\n        <div class=\"chatMsg-t1\" v-if=\"item.adm!=admin\">{{item.Thename}}说：</div>\r\n        <div class=\"chatMsg-t2\" v-if=\"item.adm!=admin\">{{item.updataTime}}</div>\r\n        <div class=\"chatMsg-t3\" v-if=\"item.adm!=admin\">{{item.content}}</div>\r\n\r\n        <div class=\"chatMsg-t1 al gb\" v-if=\"item.adm==admin\">{{item.Thename}}说：</div>\r\n        <div class=\"chatMsg-t2 al gb\" v-if=\"item.adm==admin\">{{item.updataTime}}</div>\r\n        <div class=\"chatMsg-t3 al gb\" v-if=\"item.adm==admin\">{{item.content}}</div>\r\n      </div>\r\n      <div class=\"historyRecord\">————历史纪录————</div>\r\n      <div v-for=\"(item,index) in chatList\" :key=\"index\" class=\"chatMsg\">\r\n        <div class=\"chatMsg-t1\" v-if=\"item.adm!=admin\">{{item.Thename}}说：</div>\r\n        <div class=\"chatMsg-t2\" v-if=\"item.adm!=admin\">{{item.updataTime}}</div>\r\n        <div class=\"chatMsg-t3\" v-if=\"item.adm!=admin\">\r\n          <span v-if=\"item.content\">{{item.content}}</span>\r\n          <span v-if=\"item.voice\" @click=\"startVoice(item.voice)\">[点击播放语音]</span>\r\n        </div>\r\n\r\n        <div class=\"chatMsg-t1 al gb\" v-if=\"item.adm==admin\">{{item.Thename}}说：</div>\r\n        <div class=\"chatMsg-t2 al gb\" v-if=\"item.adm==admin\">{{item.updataTime}}</div>\r\n        <div class=\"chatMsg-t3 al gb\" v-if=\"item.adm==admin\">\r\n          <span v-if=\"item.content\">{{item.content}}</span>\r\n          <span v-if=\"item.voice\" @click=\"startVoice(item.voice)\">[点击播放语音]</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"chat-page-bottom\">\r\n      <textarea type=\"text\" name=\"\" id=\"\" v-model=\"con\"></textarea>\r\n      <div class=\"sendop\">\r\n        <div class=\"sendop-b1\">\r\n          <button @click=\"show=!show\">颜艺</button>\r\n          <button @click=\"startRecord\">{{isRecording?'录音中...':'点击录音'}}</button>\r\n        </div>\r\n        <button @click=\"send\">发送</button>          \r\n      </div>\r\n    </div>\r\n\r\n    <van-popup v-model=\"show\" position=\"bottom\">\r\n      <div class=\"emojBox\">\r\n        <div v-for=\"(item,inde) in emoji\" :key=\"inde\" class=\"emojBox-items\" @click=\"selEmoj(item)\">\r\n          {{item}}\r\n        </div>\r\n      </div>\r\n    </van-popup>\r\n\r\n  </div>\r\n</template>\r\n<script>\r\nimport {Toast,Popup,Dialog } from 'vant';\r\nimport {yiiSocketIn,yiiSocketmsg} from '@/api';\r\nimport { getThename,getadmin} from '@/utils/auth'\r\nimport moment from 'moment'\r\nimport wx from 'weixin-js-sdk';\r\nexport default {\r\n  components: {\r\n    [Toast.name]: Toast,\r\n    [Popup.name]: Popup,\r\n    [Dialog.name]:Dialog,\r\n  },   \r\n  data(){\r\n    return{\r\n      show:false,\r\n      emoji:['w(ﾟДﾟ)w','ヽ(✿ﾟ▽ﾟ)ノ','(๑•̀ㅂ•́)و✧','(⊙﹏⊙)','┗|｀O′|┛','φ(≧ω≦*)♪','凸(艹皿艹 )','╰(*°▽°*)╯','（´Д`）','(#`O′)','(＠_＠;)','(ー`´ー)'],\r\n      num:'',//当前直播间人数\r\n      histortist:[],//历史信息，5条\r\n      chatList:[],\r\n      admin:getadmin(),\r\n      Thename:getThename(),       \r\n      con:'',\r\n      ws:null,\r\n      hub:'',//数据暂存,过长的数据socket会截断返回\r\n      noAdm:'',//匿名用户代号\r\n      isRecording:false,//正在录音中\r\n      localId:'',//本地录音的id\r\n      serverId:'',//本地录音上传后的服务端id\r\n      openVoice:'',//下载下来要被播放的本地音频\r\n      signature:'',\r\n    }\r\n  },\r\n  beforeRouteLeave(to, from, next) {\r\n    this.ws.close();\r\n    next();\r\n  },  \r\n  created(){\r\n    const self=this;\r\n    if(!getadmin()){\r\n      Toast('您尚未登陆，将随机分配您的用户名')\r\n      let timestamp = (new Date()).valueOf();\r\n      console.log(String(timestamp))\r\n      this.noAdm='匿名用户'+String(timestamp).substr(7,10);\r\n      console.log(this.noAdm)\r\n      this.admin=this.noAdm\r\n      this.Thename=this.noAdm\r\n    }\r\n    self.getlatest();\r\n    // this.ws=new WebSocket(\"ws://118.31.62.251:4000\");\r\n    this.ws=new WebSocket(\"wss://www.shenyifan.top/socket/\");\r\n    this.ws.onopen = function(){\r\n      console.log(\"握手成功\");\r\n    };\r\n    this.ws.onmessage = function(e){\r\n      console.log(\"message:\" + e.data);\r\n      if(JSON.parse(e.data).content||JSON.parse(e.data).voice){\r\n        self.chatList.push(JSON.parse(e.data));\r\n        self.$nextTick(function(){\r\n          var msg_box = document.getElementById('msg_box');\r\n          msg_box.scrollTop = msg_box.scrollHeight;\r\n        })\r\n      }else{\r\n        self.num=e.data;\r\n      }\r\n    };\r\n    this.ws.onerror = function(){\r\n      Toast('socket连接以断开，请刷新页面')\r\n      console.log(\"error\");\r\n    };\r\n    setTimeout(function(){\r\n      let ddd=moment().format('MMMM Do YYYY, h:mm:ss a'); \r\n      let obj={\r\n          adm:self.admin,\r\n          Thename:self.Thename,\r\n          content:self.Thename+'加入了聊天室',\r\n          'updataTime':ddd,\r\n        }\r\n      self.ws.send(JSON.stringify(obj));\r\n    },2000)\r\n  },\r\n  mounted(){\r\n    const self=this;\r\n    self.signature=sessionStorage.getItem('wxsignature');\r\n    if(self.signature){\r\n      wx.config({\r\n        debug: false, // 开启调试模式,\r\n        appId: 'wx3352249676449b29', // 必填，企业号的唯一标识，此处填写企业号corpid\r\n        timestamp:'1414587457', // 必填，生成签名的时间戳 self.sign.timestamp\r\n        nonceStr:'syf', // 必填，生成签名的随机串 self.sign.noncestr\r\n        signature:self.signature,// 必填，签名，见附录1\r\n        jsApiList: ['checkJsApi','getLocation','scanQRCode','openLocation','startRecord','stopRecord','onVoiceRecordEnd','playVoice','pauseVoice','stopVoice','onVoicePlayEnd','uploadVoice','downloadVoice'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2\r\n      }); \r\n    }\r\n   \r\n    wx.onVoiceRecordEnd({\r\n      // 录音时间超过一分钟没有停止的时候会执行 complete 回调\r\n      complete: function (res) {\r\n              self.localId = res.localId;\r\n              wx.uploadVoice({\r\n                  localId: self.localId, // 需要上传的音频的本地ID，由stopRecord接口获得\r\n                  isShowProgressTips: 1, // 默认为1，显示进度提示\r\n                  success: function (res) {\r\n                    self.serverId = res.serverId; // 返回音频的服务器端ID\r\n                    Dialog.confirm({\r\n                      title: '提示',\r\n                      message:'音频上传好了，是否发送呢？'\r\n                    }).then(() => {\r\n                          let ddd=moment().format('MMMM Do YYYY, h:mm:ss a'); \r\n                          let obj={\r\n                            adm:self.admin,\r\n                            Thename:self.Thename,\r\n                            content:'',\r\n                            'updataTime':ddd,\r\n                            'voice':self.serverId,\r\n                          }\r\n                          self.ws.send(JSON.stringify(obj));                      \r\n                    }).catch(() => {\r\n                      \r\n                    });\r\n                }\r\n              });\r\n      }\r\n    });\r\n  },\r\n  methods:{\r\n    send(){\r\n      const self=this;\r\n      if(self.isRecording){ //正在录音中\r\n          self.endAndSend();\r\n      }else{\r\n        if(!this.con){\r\n          Toast('请输入点什么')\r\n          return false;\r\n        }\r\n        let ddd=moment().format('MMMM Do YYYY, h:mm:ss a'); \r\n        let obj={\r\n          adm:self.admin,\r\n          Thename:self.Thename,\r\n          content:String(self.con),\r\n          'updataTime':ddd,\r\n        }\r\n        yiiSocketIn({ //上传每一条对话信息\r\n          'admin':self.admin,\r\n          'content':self.con,\r\n          'Thename':self.Thename,\r\n          'updataTime':ddd,\r\n        }).then((d)=>{\r\n\r\n        }).catch((d)=>{\r\n\r\n        })\r\n        this.ws.send(JSON.stringify(obj));\r\n        this.con='';\r\n      }\r\n    },\r\n    getlatest(){\r\n      const self=this;\r\n      yiiSocketmsg({\r\n      }).then((d)=>{\r\n        console.log(d);\r\n        self.histortist=d.data.errmsg;\r\n        self.histortist.reverse()\r\n        console.log(self.histortist)\r\n      }).catch((d)=>{\r\n\r\n      })\r\n    },\r\n    selEmoj(d){\r\n      this.con=this.con+d;\r\n      this.show=false;\r\n    },\r\n    startRecord(){\r\n      const self=this;\r\n      if(this.isRecording){//正在录音中,下面要结束录音\r\n          self.endAndSend();\r\n      }else{//未开始录音，下面要开始录音\r\n        this.isRecording=true;\r\n        wx.startRecord();\r\n      }\r\n    },\r\n    startVoice(d){\r\n      const self=this;\r\n      Toast('录音下载中...')\r\n        wx.downloadVoice({\r\n            serverId:d, // 需要下载的音频的服务器端ID，由uploadVoice接口获得\r\n            isShowProgressTips: 1, // 默认为1，显示进度提示\r\n            success: function (res) {\r\n              self.openVoice = res.localId; // 返回音频的本地ID\r\n              Toast('录音播放中，请开大音量:D')\r\n              wx.playVoice({\r\n                localId: self.openVoice // 需要播放的音频的本地ID，由stopRecord接口获得\r\n              });\r\n          }\r\n        }); \r\n    },\r\n    endAndSend(){ //终止录音并上传\r\n      const self=this;\r\n          this.isRecording=false;\r\n          wx.stopRecord({\r\n              success: function (res) {\r\n              self.localId = res.localId;\r\n              wx.uploadVoice({\r\n                  localId: self.localId, // 需要上传的音频的本地ID，由stopRecord接口获得\r\n                  isShowProgressTips: 1, // 默认为1，显示进度提示\r\n                  success: function (res) {\r\n                    self.serverId = res.serverId; // 返回音频的服务器端ID\r\n                    Dialog.confirm({\r\n                      title: '提示',\r\n                      message:'音频上传好了，是否发送呢？'\r\n                    }).then(() => {\r\n                          let ddd=moment().format('MMMM Do YYYY, h:mm:ss a'); \r\n                          let obj={\r\n                            adm:self.admin,\r\n                            Thename:self.Thename,\r\n                            content:'',\r\n                            'updataTime':ddd,\r\n                            'voice':self.serverId,\r\n                          }\r\n                          self.ws.send(JSON.stringify(obj));                      \r\n                    }).catch(() => {\r\n                      \r\n                    });\r\n                }\r\n              });\r\n            }\r\n          });      \r\n    },\r\n  },\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n.chat-page{\r\n  width: 100%;\r\n  height: 100vh;\r\n  position: relative;\r\n  box-sizing: border-box;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n  .ttips{\r\n    width: 100%;\r\n    color: blue;\r\n    font-size: 10px;\r\n    text-align: center;\r\n  }\r\n  .chat-page-head{\r\n    width: 100%;\r\n    height: 50px;\r\n    text-align: center;\r\n    line-height: 50px;\r\n    background: lightblue;\r\n    position: relative;\r\n\r\n  }\r\n  .chat-page-bottom{\r\n    width: 100%;\r\n    height: 100px;\r\n    background: lightblue;\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 5px;\r\n    box-sizing: border-box;\r\n    position: relative;\r\n    z-index: 101;\r\n    textarea{\r\n      height: 90px;\r\n      width: 50%;\r\n      margin-right:10px; \r\n    }\r\n    .sendop{\r\n      height: 90px;\r\n      flex: 1;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: space-around;\r\n      .sendop-b1{\r\n        height: 40px;\r\n        width: 100%;\r\n        text-align: center;\r\n        line-height: 40px;\r\n        display: flex;\r\n        justify-content: space-between;\r\n        button{\r\n          width:45%;\r\n        }\r\n      }\r\n      button{\r\n        height: 40px;\r\n        width: 100%;\r\n      }      \r\n    }\r\n\r\n  }\r\n  .chat-page-body{\r\n    width: 100%;\r\n    padding: 0 15px;\r\n    box-sizing: border-box;\r\n    flex: 1;\r\n    overflow-y: auto;\r\n  }\r\n  .chatMsg{\r\n    width: 100%;\r\n    background: lavender;\r\n    margin: 5px 0;\r\n    box-sizing: border-box;\r\n    border-radius:4px; \r\n    padding: 4px;\r\n    box-sizing: border-box;\r\n    .chatMsg-t1{\r\n      font-size: 15px;\r\n      font-weight: 600;\r\n    }\r\n    .chatMsg-t2{\r\n      font-weight:100;\r\n      font-size: 10px;\r\n      color: #999;\r\n    }\r\n    .chatMsg-t3{\r\n      padding: 0 10px;\r\n      box-sizing: border-box;\r\n    }\r\n  }\r\n  .al{\r\n    text-align: right;\r\n  }\r\n  .gb{\r\n    background: lightgreen;\r\n  }\r\n  .emojBox{\r\n    width: 100%;\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    justify-content: space-around;\r\n    .emojBox-items{\r\n      width: 22%;\r\n      height: 20px;\r\n      text-align: center;\r\n      overflow: hidden;\r\n      margin:20px 0;\r\n      background: lavender;\r\n    }\r\n  }\r\n  .historyRecord{\r\n    width: 100%;\r\n    text-align: center;\r\n    color: #999;\r\n    font-size: 10px;\r\n  }\r\n}\r\n</style>\r\n\r\n\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./chatRoom.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./chatRoom.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./chatRoom.vue?vue&type=template&id=6108ccf0&\"\nimport script from \"./chatRoom.vue?vue&type=script&lang=js&\"\nexport * from \"./chatRoom.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chatRoom.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./chatRoom.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./chatRoom.vue?vue&type=style&index=0&lang=scss&\""],"sourceRoot":""}