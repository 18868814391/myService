(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b77d1ba"],{"2e3a":function(t,e,s){"use strict";s.r(e);var a,n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chat-page"},[s("div",{staticClass:"chat-page-head"},[t._v("\n    当前在线人数"+t._s(t.num)+"\n    ")]),s("div",{staticClass:"chat-page-body",attrs:{id:"msg_box"}},[t._l(t.histortist,function(e,a){return s("div",{key:a,staticClass:"chatMsg"},[e.adm!=t.admin?s("div",{staticClass:"chatMsg-t1"},[t._v(t._s(e.Thename)+"说：")]):t._e(),e.adm!=t.admin?s("div",{staticClass:"chatMsg-t2"},[t._v(t._s(e.updataTime))]):t._e(),e.adm!=t.admin?s("div",{staticClass:"chatMsg-t3"},[t._v(t._s(e.content))]):t._e(),e.adm==t.admin?s("div",{staticClass:"chatMsg-t1 al gb"},[t._v(t._s(e.Thename)+"说：")]):t._e(),e.adm==t.admin?s("div",{staticClass:"chatMsg-t2 al gb"},[t._v(t._s(e.updataTime))]):t._e(),e.adm==t.admin?s("div",{staticClass:"chatMsg-t3 al gb"},[t._v(t._s(e.content))]):t._e()])}),s("div",{staticClass:"historyRecord"},[t._v("————历史纪录————")]),t._l(t.chatList,function(e,a){return s("div",{key:a,staticClass:"chatMsg"},[e.adm!=t.admin?s("div",{staticClass:"chatMsg-t1"},[t._v(t._s(e.Thename)+"说：")]):t._e(),e.adm!=t.admin?s("div",{staticClass:"chatMsg-t2"},[t._v(t._s(e.updataTime))]):t._e(),e.adm!=t.admin?s("div",{staticClass:"chatMsg-t3"},[e.content?s("span",[t._v(t._s(e.content))]):t._e(),e.voice?s("span",{on:{click:function(s){return t.startVoice(e.voice)}}},[t._v("[点击播放语音]")]):t._e()]):t._e(),e.adm==t.admin?s("div",{staticClass:"chatMsg-t1 al gb"},[t._v(t._s(e.Thename)+"说：")]):t._e(),e.adm==t.admin?s("div",{staticClass:"chatMsg-t2 al gb"},[t._v(t._s(e.updataTime))]):t._e(),e.adm==t.admin?s("div",{staticClass:"chatMsg-t3 al gb"},[e.content?s("span",[t._v(t._s(e.content))]):t._e(),e.voice?s("span",{on:{click:function(s){return t.startVoice(e.voice)}}},[t._v("[点击播放语音]")]):t._e()]):t._e()])})],2),s("div",{staticClass:"chat-page-bottom"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.con,expression:"con"}],attrs:{type:"text",name:"",id:""},domProps:{value:t.con},on:{input:function(e){e.target.composing||(t.con=e.target.value)}}}),s("div",{staticClass:"sendop"},[s("div",{staticClass:"sendop-b1"},[s("button",{on:{click:function(e){t.show=!t.show}}},[t._v("颜艺")]),s("button",{on:{click:t.startRecord}},[t._v(t._s(t.isRecording?"录音中...":"点击录音"))])]),s("button",{on:{click:t.send}},[t._v("发送")])])]),s("van-popup",{attrs:{position:"bottom"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[s("div",{staticClass:"emojBox"},t._l(t.emoji,function(e,a){return s("div",{key:a,staticClass:"emojBox-items",on:{click:function(s){return t.selEmoj(e)}}},[t._v("\n        "+t._s(e)+"\n      ")])}),0)])],1)},o=[],i=s("f499"),c=s.n(i),d=s("bd86"),r=(s("7f7f"),s("b970")),m=s("365c"),l=s("5f87"),h=s("c1df"),u=s.n(h),v=s("18a0"),g=s.n(v),p={components:(a={},Object(d["a"])(a,r["o"].name,r["o"]),Object(d["a"])(a,r["i"].name,r["i"]),Object(d["a"])(a,r["d"].name,r["d"]),a),data:function(){return{show:!1,emoji:["w(ﾟДﾟ)w","ヽ(✿ﾟ▽ﾟ)ノ","(๑•̀ㅂ•́)و✧","(⊙﹏⊙)","┗|｀O′|┛","φ(≧ω≦*)♪","凸(艹皿艹 )","╰(*°▽°*)╯","（´Д`）","(#`O′)","(＠_＠;)","(ー`´ー)"],num:"",histortist:[],chatList:[],admin:Object(l["b"])(),Thename:Object(l["a"])(),con:"",ws:null,hub:"",noAdm:"",isRecording:!1,localId:"",serverId:"",openVoice:"",signature:""}},beforeRouteLeave:function(t,e,s){this.ws.close(),s()},created:function(){var t=this;if(!Object(l["b"])()){Object(r["o"])("您尚未登陆，将随机分配您的用户名");var e=(new Date).valueOf();console.log(String(e)),this.noAdm="匿名用户"+String(e).substr(7,10),console.log(this.noAdm),this.admin=this.noAdm,this.Thename=this.noAdm}t.getlatest(),this.ws=new WebSocket("wss://www.shenyifan.top/socket/"),this.ws.onopen=function(){console.log("握手成功")},this.ws.onmessage=function(e){console.log("message:"+e.data),JSON.parse(e.data).content||JSON.parse(e.data).voice?(t.chatList.push(JSON.parse(e.data)),t.$nextTick(function(){var t=document.getElementById("msg_box");t.scrollTop=t.scrollHeight})):t.num=e.data},this.ws.onerror=function(){Object(r["o"])("socket连接以断开，请刷新页面"),console.log("error")},setTimeout(function(){var e=u()().format("MMMM Do YYYY, h:mm:ss a"),s={adm:t.admin,Thename:t.Thename,content:t.Thename+"加入了聊天室",updataTime:e};t.ws.send(c()(s))},2e3)},mounted:function(){var t=this;t.signature=sessionStorage.getItem("wxsignature"),t.signature&&g.a.config({debug:!1,appId:"wx3352249676449b29",timestamp:"1414587457",nonceStr:"syf",signature:t.signature,jsApiList:["checkJsApi","getLocation","scanQRCode","openLocation","startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice"]}),g.a.onVoiceRecordEnd({complete:function(e){t.localId=e.localId,g.a.uploadVoice({localId:t.localId,isShowProgressTips:1,success:function(e){t.serverId=e.serverId,r["d"].confirm({title:"提示",message:"音频上传好了，是否发送呢？"}).then(function(){var e=u()().format("MMMM Do YYYY, h:mm:ss a"),s={adm:t.admin,Thename:t.Thename,content:"",updataTime:e,voice:t.serverId};t.ws.send(c()(s))}).catch(function(){})}})}})},methods:{send:function(){var t=this;if(t.isRecording)t.endAndSend();else{if(!this.con)return Object(r["o"])("请输入点什么"),!1;var e=u()().format("MMMM Do YYYY, h:mm:ss a"),s={adm:t.admin,Thename:t.Thename,content:String(t.con),updataTime:e};Object(m["x"])({admin:t.admin,content:t.con,Thename:t.Thename,updataTime:e}).then(function(t){}).catch(function(t){}),this.ws.send(c()(s)),this.con=""}},getlatest:function(){var t=this;Object(m["y"])({}).then(function(e){console.log(e),t.histortist=e.data.errmsg,t.histortist.reverse(),console.log(t.histortist)}).catch(function(t){})},selEmoj:function(t){this.con=this.con+t,this.show=!1},startRecord:function(){var t=this;this.isRecording?t.endAndSend():(this.isRecording=!0,g.a.startRecord())},startVoice:function(t){var e=this;Object(r["o"])("录音下载中..."),g.a.downloadVoice({serverId:t,isShowProgressTips:1,success:function(t){e.openVoice=t.localId,Object(r["o"])("录音播放中，请开大音量:D"),g.a.playVoice({localId:e.openVoice})}})},endAndSend:function(){var t=this;this.isRecording=!1,g.a.stopRecord({success:function(e){t.localId=e.localId,g.a.uploadVoice({localId:t.localId,isShowProgressTips:1,success:function(e){t.serverId=e.serverId,r["d"].confirm({title:"提示",message:"音频上传好了，是否发送呢？"}).then(function(){var e=u()().format("MMMM Do YYYY, h:mm:ss a"),s={adm:t.admin,Thename:t.Thename,content:"",updataTime:e,voice:t.serverId};t.ws.send(c()(s))}).catch(function(){})}})}})}}},f=p,_=(s("50dc"),s("2877")),b=Object(_["a"])(f,n,o,!1,null,null,null);e["default"]=b.exports},"50dc":function(t,e,s){"use strict";var a=s("f39a"),n=s.n(a);n.a},f39a:function(t,e,s){}}]);
//# sourceMappingURL=chunk-7b77d1ba.3f46eb31.js.map