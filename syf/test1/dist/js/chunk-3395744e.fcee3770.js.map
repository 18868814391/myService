{"version":3,"sources":["webpack:///./src/pages/ChatHistory.vue?9715","webpack:///./src/pages/ChatHistory.vue?c5a3","webpack:///src/pages/ChatHistory.vue","webpack:///./src/pages/ChatHistory.vue?6933","webpack:///./src/pages/ChatHistory.vue"],"names":["_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_ChatHistory_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_ChatHistory_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0___default","n","render","_vm","this","_h","$createElement","_c","_self","staticClass","on","click","onClickBack","_v","_s","sessionName","directives","name","rawName","value","expression","arg","ref","attrs","type","canLoadMore","msglist","userInfos","myInfo","isHistory","staticRenderFns","ChatHistoryvue_type_script_lang_js_","beforeMount","$store","state","isRefresh","location","href","concat","sessionId","mounted","dispatch","getHistoryMsgs","updated","tempPagePos","page","getChatListHeight","scrollChatListDown","currPagePos","components","Object","defineProperty","ChatList","es","data","leftBtnOptions","backText","preventGoBack","computed","$route","params","user","test","replace","userUID","isRobot","robotInfos","nick","userInfo","utils","getFriendAlias","msgs","currSessionMsgs","scene","parseSession","to","noMoreHistoryMsgs","methods","loadMore","getChatListScroll","window","history","go","pages_ChatHistoryvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__"],"mappings":"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","file":"js/chunk-3395744e.fcee3770.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChatHistory.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChatHistory.vue?vue&type=style&index=0&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"g-inherit m-article p-chat-history\"},[_c('div',{staticClass:\"Chat-nav\"},[_c('div',{on:{\"click\":_vm.onClickBack}},[_vm._v(\"返回\")]),_c('span',[_vm._v(_vm._s(_vm.sessionName))]),_c('div')]),_c('div',{staticClass:\"m-chat-main\"},[_c('chat-list',{directives:[{name:\"touch\",rawName:\"v-touch:swipedown\",value:(_vm.loadMore),expression:\"loadMore\",arg:\"swipedown\"}],ref:\"chatlist\",attrs:{\"type\":\"session\",\"canLoadMore\":_vm.canLoadMore,\"msglist\":_vm.msglist,\"userInfos\":_vm.userInfos,\"myInfo\":_vm.myInfo,\"isHistory\":true}})],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"g-inherit m-article p-chat-history\">\r\n    <div class=\"Chat-nav\">\r\n      <div @click=\"onClickBack\">返回</div>\r\n      <span>{{sessionName}}</span>\r\n      <div></div>\r\n    </div>    \r\n    <div class=\"m-chat-main\">\r\n      <chat-list\r\n        ref=\"chatlist\"\r\n        type=\"session\"\r\n        :canLoadMore=\"canLoadMore\"\r\n        :msglist=\"msglist\"\r\n        :userInfos=\"userInfos\"\r\n        :myInfo=\"myInfo\"\r\n        :isHistory='true'\r\n        v-touch:swipedown=\"loadMore\"\r\n      ></chat-list>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport ChatList from './components/ChatList'\r\nimport util from '../utils'\r\nimport pageUtil from '../utils/page'\r\nimport { NavBar } from 'vant';\r\n\r\nexport default {\r\n  beforeMount () {\r\n    // 如果是刷新页面，重定向至聊天页面\r\n    if (this.$store.state.isRefresh) {\r\n      location.href = `#/chat/${this.sessionId}`\r\n    }\r\n  },\r\n  mounted () {\r\n    this.$store.dispatch('resetNoMoreHistoryMsgs')\r\n    this.getHistoryMsgs()\r\n  },\r\n  updated () {\r\n    let tempPagePos = pageUtil.getChatListHeight()\r\n    pageUtil.scrollChatListDown(tempPagePos - this.currPagePos)\r\n    this.currPagePos = tempPagePos\r\n  },\r\n  components: {\r\n    ChatList,\r\n    [NavBar.name]: NavBar,\r\n  },\r\n  data () {\r\n    return {\r\n      leftBtnOptions: {\r\n        backText: ' ',\r\n        preventGoBack: true,\r\n      },\r\n      currPagePos: 0,\r\n      // selectedDate: ''\r\n    }\r\n  },\r\n  computed: {\r\n    sessionId () {\r\n      return this.$route.params.sessionId\r\n    },\r\n    sessionName () {\r\n      let sessionId = this.sessionId\r\n      let user = null\r\n      if (/^p2p-/.test(sessionId)) {\r\n        user = sessionId.replace(/^p2p-/, '')\r\n        if (user === this.$store.state.userUID) {\r\n          return '我的手机'\r\n        } else if (this.isRobot) {\r\n          return this.robotInfos[user].nick || user\r\n        } else {\r\n          let userInfo = this.userInfos[user] || {}\r\n          return util.getFriendAlias(userInfo)\r\n        }\r\n      } else if (/^team-/.test(sessionId)) {\r\n        return '历史记录'\r\n      }\r\n    },\r\n    // 判断是否是机器人\r\n    isRobot () {\r\n      let sessionId = this.sessionId\r\n      let user = null\r\n      if (/^p2p-/.test(sessionId)) {\r\n        user = sessionId.replace(/^p2p-/, '')\r\n        if (this.robotInfos[user]) {\r\n          return true\r\n        }\r\n      }\r\n      return false\r\n    },\r\n    myInfo () {\r\n      return this.$store.state.myInfo\r\n    },\r\n    userInfos () {\r\n      return this.$store.state.userInfos\r\n    },\r\n    msglist () {\r\n      let msgs = this.$store.state.currSessionMsgs\r\n      return msgs\r\n    },\r\n    robotInfos () {\r\n      return this.$store.state.robotInfos\r\n    },\r\n    scene () {\r\n      return util.parseSession(this.sessionId).scene\r\n    },\r\n    to () {\r\n      return util.parseSession(this.sessionId).to\r\n    },\r\n    canLoadMore () {\r\n      return !this.$store.state.noMoreHistoryMsgs\r\n    }\r\n  },\r\n  methods: {\r\n    getHistoryMsgs () {\r\n      if (this.canLoadMore) {\r\n        this.$store.dispatch('getHistoryMsgs', {\r\n          scene: this.scene,\r\n          to: this.to\r\n        })\r\n      }\r\n    },\r\n    loadMore () {\r\n      if (pageUtil.getChatListScroll() <= 5) {\r\n        this.getHistoryMsgs()\r\n      }\r\n    },\r\n    onClickBack: function () {\r\n      // location.href = `#/chat/${this.sessionId}`\r\n      window.history.go(-1)\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n  .p-chat-history {\r\n    .m-chat-main {\r\n      padding: 0;\r\n    }\r\n  }\r\n.Chat-nav{\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    margin: 0;\r\n    width: 100%;\r\n    height: 60px;\r\n    overflow: hidden;\r\n    z-index: 3;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    box-sizing: border-box;\r\n    padding: 0 15px;\r\n    background: #e5f4ff;\r\n    color: #0091e4;\r\n} \r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChatHistory.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChatHistory.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ChatHistory.vue?vue&type=template&id=5d72b712&\"\nimport script from \"./ChatHistory.vue?vue&type=script&lang=js&\"\nexport * from \"./ChatHistory.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ChatHistory.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}