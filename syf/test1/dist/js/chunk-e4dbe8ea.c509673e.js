(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-e4dbe8ea"],{"47e4":function(e,t,i){"use strict";var o=i("b50c");i.n(o).a},"49b2":function(e,t,i){},7856:function(e,t,i){"use strict";var o=i("49b2");i.n(o).a},a850:function(e,t,i){"use strict";i("f61f");var o="http://yx-web.nosdn.127.net/webdoc/h5/emoji",s={emoji:{"[大笑]":{file:"emoji_0.png"},"[可爱]":{file:"emoji_01.png"},"[色]":{file:"emoji_02.png"},"[嘘]":{file:"emoji_03.png"},"[亲]":{file:"emoji_04.png"},"[呆]":{file:"emoji_05.png"},"[口水]":{file:"emoji_06.png"},"[汗]":{file:"emoji_145.png"},"[呲牙]":{file:"emoji_07.png"},"[鬼脸]":{file:"emoji_08.png"},"[害羞]":{file:"emoji_09.png"},"[偷笑]":{file:"emoji_10.png"},"[调皮]":{file:"emoji_11.png"},"[可怜]":{file:"emoji_12.png"},"[敲]":{file:"emoji_13.png"},"[惊讶]":{file:"emoji_14.png"},"[流感]":{file:"emoji_15.png"},"[委屈]":{file:"emoji_16.png"},"[流泪]":{file:"emoji_17.png"},"[嚎哭]":{file:"emoji_18.png"},"[惊恐]":{file:"emoji_19.png"},"[怒]":{file:"emoji_20.png"},"[酷]":{file:"emoji_21.png"},"[不说]":{file:"emoji_22.png"},"[鄙视]":{file:"emoji_23.png"},"[阿弥陀佛]":{file:"emoji_24.png"},"[奸笑]":{file:"emoji_25.png"},"[睡着]":{file:"emoji_26.png"},"[口罩]":{file:"emoji_27.png"},"[努力]":{file:"emoji_28.png"},"[抠鼻孔]":{file:"emoji_29.png"},"[疑问]":{file:"emoji_30.png"},"[怒骂]":{file:"emoji_31.png"},"[晕]":{file:"emoji_32.png"},"[呕吐]":{file:"emoji_33.png"},"[拜一拜]":{file:"emoji_160.png"},"[惊喜]":{file:"emoji_161.png"},"[流汗]":{file:"emoji_162.png"},"[卖萌]":{file:"emoji_163.png"},"[默契眨眼]":{file:"emoji_164.png"},"[烧香拜佛]":{file:"emoji_165.png"},"[晚安]":{file:"emoji_166.png"},"[强]":{file:"emoji_34.png"},"[弱]":{file:"emoji_35.png"},"[OK]":{file:"emoji_36.png"},"[拳头]":{file:"emoji_37.png"},"[胜利]":{file:"emoji_38.png"},"[鼓掌]":{file:"emoji_39.png"},"[握手]":{file:"emoji_200.png"},"[发怒]":{file:"emoji_40.png"},"[骷髅]":{file:"emoji_41.png"},"[便便]":{file:"emoji_42.png"},"[火]":{file:"emoji_43.png"},"[溜]":{file:"emoji_44.png"},"[爱心]":{file:"emoji_45.png"},"[心碎]":{file:"emoji_46.png"},"[钟情]":{file:"emoji_47.png"},"[唇]":{file:"emoji_48.png"},"[戒指]":{file:"emoji_49.png"},"[钻石]":{file:"emoji_50.png"},"[太阳]":{file:"emoji_51.png"},"[有时晴]":{file:"emoji_52.png"},"[多云]":{file:"emoji_53.png"},"[雷]":{file:"emoji_54.png"},"[雨]":{file:"emoji_55.png"},"[雪花]":{file:"emoji_56.png"},"[爱人]":{file:"emoji_57.png"},"[帽子]":{file:"emoji_58.png"},"[皇冠]":{file:"emoji_59.png"},"[篮球]":{file:"emoji_60.png"},"[足球]":{file:"emoji_61.png"},"[垒球]":{file:"emoji_62.png"},"[网球]":{file:"emoji_63.png"},"[台球]":{file:"emoji_64.png"},"[咖啡]":{file:"emoji_65.png"},"[啤酒]":{file:"emoji_66.png"},"[干杯]":{file:"emoji_67.png"},"[柠檬汁]":{file:"emoji_68.png"},"[餐具]":{file:"emoji_69.png"},"[汉堡]":{file:"emoji_70.png"},"[鸡腿]":{file:"emoji_71.png"},"[面条]":{file:"emoji_72.png"},"[冰淇淋]":{file:"emoji_73.png"},"[沙冰]":{file:"emoji_74.png"},"[生日蛋糕]":{file:"emoji_75.png"},"[蛋糕]":{file:"emoji_76.png"},"[糖果]":{file:"emoji_77.png"},"[葡萄]":{file:"emoji_78.png"},"[西瓜]":{file:"emoji_79.png"},"[光碟]":{file:"emoji_80.png"},"[手机]":{file:"emoji_81.png"},"[电话]":{file:"emoji_82.png"},"[电视]":{file:"emoji_83.png"},"[声音开启]":{file:"emoji_84.png"},"[声音关闭]":{file:"emoji_85.png"},"[铃铛]":{file:"emoji_86.png"},"[锁头]":{file:"emoji_87.png"},"[放大镜]":{file:"emoji_88.png"},"[灯泡]":{file:"emoji_89.png"},"[锤头]":{file:"emoji_90.png"},"[烟]":{file:"emoji_91.png"},"[炸弹]":{file:"emoji_92.png"},"[枪]":{file:"emoji_93.png"},"[刀]":{file:"emoji_94.png"},"[药]":{file:"emoji_95.png"},"[打针]":{file:"emoji_96.png"},"[钱袋]":{file:"emoji_97.png"},"[钞票]":{file:"emoji_98.png"},"[银行卡]":{file:"emoji_99.png"},"[手柄]":{file:"emoji_100.png"},"[麻将]":{file:"emoji_101.png"},"[调色板]":{file:"emoji_102.png"},"[电影]":{file:"emoji_103.png"},"[麦克风]":{file:"emoji_104.png"},"[耳机]":{file:"emoji_105.png"},"[音乐]":{file:"emoji_106.png"},"[吉他]":{file:"emoji_107.png"},"[火箭]":{file:"emoji_108.png"},"[飞机]":{file:"emoji_109.png"},"[火车]":{file:"emoji_110.png"},"[公交]":{file:"emoji_111.png"},"[轿车]":{file:"emoji_112.png"},"[出租车]":{file:"emoji_113.png"},"[警车]":{file:"emoji_114.png"},"[自行车]":{file:"emoji_115.png"}}};for(var n in s){var a=s[n];for(var l in a){var m=a[l];m.img="".concat(o,"/").concat(n,"/").concat(m.file)}}for(var r={ajmd:{},xxy:{},lt:{}},g=1;g<=48;g++){var f="ajmd0"+(10<=g?g:"0"+g);r.ajmd[f]={file:f+".png"}}for(var p=1;p<=40;p++){var c="xxy0"+(10<=p?p:"0"+p);r.xxy[c]={file:c+".png"}}for(var u=1;u<=20;u++){var d="lt0"+(10<=u?u:"0"+u);r.lt[d]={file:d+".png"}}for(var _ in r){var h=r[_];for(var j in h){var y=h[j];y.img="".concat(o,"/").concat(_,"/").concat(y.file)}}t.a={emojiList:s,pinupList:r}},b50c:function(e,t,i){},ef1a:function(e,t,i){"use strict";var g=i("ed08"),f=i("f61f"),p=i("a850"),o=(i("55dd"),i("a481"),i("ac6a"),i("4917"),i("5176")),c=i.n(o),s=(i("7f7f"),i("e814")),n=i.n(s),r=(i("7514"),{$node:null,$audio:null,timeout:"",imgPlay0:"https://yx-web-nosdn.netease.im/quickhtml%2Fassets%2Fyunxin%2Fdefault%2Fplay0.gif",imgPlay1:"https://yx-web-nosdn.netease.im/quickhtml%2Fassets%2Fyunxin%2Fdefault%2Fplay1.gif"}),a={props:{type:String,rawMsg:{type:Object,default:function(){return{}}},userInfos:{type:Object,default:function(){return{}}},myInfo:{type:Object,default:function(){return{}}},isRobot:{type:Boolean,default:function(){return!1}},isHistory:{type:Boolean,default:function(){return!1}}},data:function(){return{msg:"",isFullImgShow:!1}},computed:{robotInfos:function(){return this.$store.state.robotInfos},teamMsgUnRead:function(){var t=this,e=!this.isHistory&&this.msg.needMsgReceipt&&"out"===this.msg.flow&&this.$store.state.teamMsgReads.find(function(e){return e.idServer===t.msg.idServer});return e?n()(e.unread):-1}},watch:{rawMsg:function(e,t){var i=e&&e.localCustom;i&&e&&"audio"===e.type&&(i!==(t&&t.localCustom)&&this.computedItem())}},beforeMount:function(){this.computedItem()},mounted:function(){var i=this,o=this.msg;window.stopPlayAudio=this.stopPlayAudio.bind(this),this.$nextTick(function(){var e=null;if("image"===o.type)(e=new Image).src=o.file.url+"?imageView&thumbnail=180x0&quality=85";else if("custom-type1"===o.type)(e=new Image).className="emoji-middle",e.src=o.imgUrl;else if("custom-type3"===o.type)(e=new Image).className="emoji-big",e.src=o.imgUrl;else if("video"===o.type)if(/(mov|mp4|ogg|webm)/i.test(o.file.ext))(e=document.createElement("video")).src=o.file.url,e.width=640,e.height=480,e.autoStart=!1,e.preload="metadata",e.controls="controls";else{var t=document.createElement("a");t.href=o.file.url,t.target="_blank",t.innerHTML='<i class="u-icon icon-file"></i>'.concat(video.name),i.$refs.mediaMsg.appendChild(t)}e?(i.$refs.mediaMsg&&i.$refs.mediaMsg.appendChild(e),e.onload=function(){i.$emit("msg-loaded")},e.onerror=function(){i.$emit("msg-loaded")}):i.$emit("msg-loaded")})},methods:{computedItem:function(){var i=c()({},this.rawMsg);if("session"===this.type)if("in"===i.flow)if("robot"===i.type&&i.content&&i.content.msgOut){var e=i.content.robotAccid;i.avatar=this.robotInfos[e].avatar,i.isRobot=!0,i.link="#/namecard/".concat(e)}else i.from!==this.$store.state.userUID?(i.avatar=this.userInfos[i.from]&&this.userInfos[i.from].avatar||f.a.defaultUserIcon,i.link="#/namecard/".concat(i.from)):i.avatar=this.myInfo.avatar;else"out"===i.flow&&(i.avatar=this.myInfo.avatar);else i.showTime=g.a.formatDate(i.time);if("timeTag"===i.type)i.showText=i.text;else if("text"===i.type){if(i.showText=g.a.escape(i.text),/\[[^\]]+\]/.test(i.showText))i.showText.match(/\[[^\]]+\]/g).forEach(function(e){var t=p.a.emojiList.emoji;t[e]&&(i.showText=i.showText.replace(e,'<img class="emoji-small" src="'.concat(t[e].img,'">')))})}else if("custom"===i.type){var t=JSON.parse(i.content);if(1===t.type){var o=t.data,s=f.a.resourceUrl;i.type="custom-type1",i.imgUrl="".concat(s,"/im/play-").concat(o.value,".png")}else if(3===t.type){var n=t.data,a="";p.a.pinupList[n.catalog]&&(a=p.a.pinupList[n.catalog][n.chartlet],i.type="custom-type3",i.imgUrl="".concat(a.img))}else i.showText=g.a.parseCustomMsg(i),"[自定义消息]"!==i.showText&&(i.showText+=",请到手机或电脑客户端查看")}else if("image"===i.type)i.originLink=i.file.url;else if("video"===i.type);else if("audio"===i.type)i.width=(5.3+.03*Math.round(i.file.dur/1e3)).toFixed(2)+"rem",i.audioSrc=i.file.mp3Url,i.showText="<i>"+Math.round(i.file.dur/1e3)+'"</i> 点击播放',!this.isHistory&&nim.useDb&&(i.unreadAudio=!i.localCustom);else if("file"===i.type)i.fileLink=i.file.url,i.showText=i.file.name;else if("notification"===i.type)"team"===i.scene?i.showText=g.a.generateTeamSysmMsg(i):i.showText=g.a.generateChatroomSysMsg(i);else if("tip"===i.type)i.showText=i.tip;else if("robot"===i.type){var l=i.content||{},m=l.message||[];if(l.msgOut){if("bot"===l.flag)i.subType="bot",m=m.map(function(e){return"template"===e.type?e.content.json:"text"===e.type||"answer"===e.type?[{type:"text",text:e.content}]:"image"===e.type?[{type:"image",url:e.content}]:void 0}),i.message=m;else if("faq"===i.content.flag){i.subType="faq",i.query=m.query;var r=m.match.sort(function(e,t){return t.score-e.score});i.message=r[0]}}else i.robotFlow="out",i.showText=i.text}else i.showText="[".concat(g.a.mapMsgType(i),"],请到手机或电脑客户端查看");this.msg=i},revocateMsg:function(e){if(this.$store.state.currSessionId&&e&&e.data&&e.data.attrs){var t=e.data.attrs;if("robot"===t.type)return;if("out"===t.flow){var i=this;this.$vux.confirm.show({title:"确定需要撤回消息",onCancel:function(){},onConfirm:function(){i.$store.dispatch("revocateMsg",{idClient:t.idClient})}})}}},sendRobotBlockMsg:function(e,t){if(!this.isHistory){var i="[复杂按钮模板触发消息]";e.text&&1===e.text.length&&(i=e.text[0].text);var o=t.content.robotAccid;this.isRobot||(i="@".concat(this.robotInfos[o].nick," ").concat(i)),"session"===this.type?this.$store.dispatch("sendRobotMsg",{type:"link",scene:t.scene,to:t.to,robotAccid:o,params:e.params,target:e.target,body:i}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomRobotMsg",{type:"link",robotAccid:o,params:e.params,target:e.target,body:i})}},continueRobotMsg:function(e){this.$store.dispatch("continueRobotMsg",e)},showFullImg:function(e){this.$store.dispatch("showFullscreenImg",{src:e})},autoPlayNextUnreadAudio:function(){var e=r.$node&&r.$node.parentElement;if(e){for(var t,i=e.parentElement.nextElementSibling;i&&(!~i.className.indexOf("item-you")||!(t=i.querySelector(".msg-audio")));)i=i.nextElementSibling;i&&~t.className.indexOf("unreadAudio")&&t.click()}},playAudio:function(e,t){var i,o=this;if(i=~t.target.className.indexOf("msg-audio")?t.target:t.target.parentElement,r.$audio){var s=i.childNodes[2],n=s&&"IMG"===s.tagName;if(this.stopPlayAudio(),n)return}var a=e.file.dur;if(a){r.$audio=document.createElement("audio");var l=document.createElement("source"),m=e.file.ext;l.src=e.file.url,l.type="audio/"+("mp3"===m?"mpeg":m),r.$audio.appendChild(l),r.$audio.play(),(r.$node=i).innerHTML=i.innerHTML.replace("点击播放",'<img src="'+("in"===e.flow?r.imgPlay1:r.imgPlay0)+'">'),r.timeout=setTimeout(function(){r.$audio=null,o.canclePlayAudio()},a),~r.$node.className.indexOf("unreadAudio")&&(e.localCustom='{"audio": "played"}',this.$store.dispatch("updateLocalMsg",e),r.$node.className=r.$node.className.replace("unreadAudio",""),r.$audio.onended=this.autoPlayNextUnreadAudio.bind(this))}},canclePlayAudio:function(){r.$node.childNodes[2]&&r.$node.removeChild(r.$node.childNodes[2]),r.$node.innerHTML+="点击播放"},stopPlayAudio:function(){r.$audio&&(r.$audio.pause(),this.canclePlayAudio(),clearTimeout(r.timeout),r.$audio=null,r.$node=null,r.timeout="")},toMsgUnReadDetail:function(){this.href="#/msgReceiptDetail/"+this.msg.idServer}}},l=(i("7856"),i("2877")),m={components:{ChatItem:Object(l.a)(a,function(){var i=this,e=i.$createElement,o=i._self._c||e;return o("li",{staticClass:"u-msg",class:{"item-me":"out"===i.msg.flow,"item-you":"in"===i.msg.flow,"item-time":"timeTag"===i.msg.type,"item-tip":"tip"===i.msg.type,"session-chat":"session"===i.type}},["timeTag"===i.msg.type?o("div",[i._v("---- "+i._s(i.msg.showText)+" ----")]):"tip"===i.msg.type?o("div",{staticClass:"tip"},[i._v(i._s(i.msg.showText))]):"notification"===i.msg.type&&"team"===i.msg.scene?o("div",{staticClass:"notification"},[i._v(i._s(i.msg.showText))]):"in"===i.msg.flow||"out"===i.msg.flow?o("div",{directives:[{name:"touch",rawName:"v-touch:hold",value:i.revocateMsg,expression:"revocateMsg",arg:"hold"}],attrs:{idClient:i.msg.idClient,time:i.msg.time,flow:i.msg.flow,type:i.msg.type}},[i.msg.avatar?o("a",{staticClass:"msg-head",attrs:{href:i.msg.link}},[o("img",{staticClass:"icon u-circle",attrs:{src:i.msg.avatar}})]):"notification"!==i.msg.type?o("p",{staticClass:"msg-user"},[o("em",[i._v(i._s(i.msg.showTime))]),i._v(i._s(i.msg.from))]):i._e(),"text"===i.msg.type?o("span",{staticClass:"msg-text",domProps:{innerHTML:i._s(i.msg.showText)}}):"custom-type1"===i.msg.type?o("span",{ref:"mediaMsg",staticClass:"msg-text"}):"custom-type3"===i.msg.type?o("span",{ref:"mediaMsg",staticClass:"msg-text"}):"image"===i.msg.type?o("span",{ref:"mediaMsg",staticClass:"msg-text",on:{click:function(e){return e.stopPropagation(),i.showFullImg(i.msg.originLink)}}}):"video"===i.msg.type?o("span",{ref:"mediaMsg",staticClass:"msg-text"}):"audio"===i.msg.type?o("span",{staticClass:"msg-text msg-audio",class:{unreadAudio:i.msg.unreadAudio},style:"width: "+i.msg.width,domProps:{innerHTML:i._s(i.msg.showText)},on:{click:function(e){return i.playAudio(i.msg,e)}}}):"file"===i.msg.type?o("span",{staticClass:"msg-text"},[o("a",{attrs:{href:i.msg.fileLink,target:"_blank"}},[o("i",{staticClass:"u-icon icon-file"}),i._v(i._s(i.msg.showText))])]):"robot"===i.msg.type?o("span",{staticClass:"msg-text",class:{"msg-robot":"out"!==i.msg.robotFlow&&!i.isRobot}},["out"===i.msg.robotFlow?o("div",[i._v(i._s(i.msg.showText))]):"bot"===i.msg.subType?o("div",i._l(i.msg.message,function(e){return o("div",i._l(e,function(t){return o("div",["text"===t.type?o("div",[o("p",[i._v(i._s(t.text))])]):"image"===t.type?o("div",[o("p",[o("img",{attrs:{src:t.url}})])]):"url"===t.type?o("div",[o("a",{class:t.style,attrs:{href:t.target,target:"_blank"}},[t.image?o("div",i._l(t.image,function(e){return o("p",[o("img",{attrs:{src:e.url}})])}),0):i._e(),t.text?o("div",i._l(t.text,function(e){return o("p",[i._v(i._s(e.text))])}),0):i._e()])]):"block"===t.type?o("div",[o("a",{class:t.style,attrs:{params:t.params,target:t.target},on:{click:function(e){return i.sendRobotBlockMsg(t,i.msg)}}},[t.image?o("div",i._l(t.image,function(e){return o("p",[o("img",{attrs:{src:e.url}})])}),0):i._e(),t.text?o("div",i._l(t.text,function(e){return o("p",[i._v(i._s(e.text))])}),0):i._e()])]):i._e()])}),0)}),0):"faq"===i.msg.subType?o("div",[o("p",[i._v(i._s(i.msg.message.answer))])]):i._e(),"out"===i.msg.robotFlow||i.isRobot?i._e():o("span",{staticClass:"msg-link"},[o("a",{staticClass:"link-right",on:{click:function(e){return i.continueRobotMsg(i.msg.content.robotAccid)}}},[i._v("继续对话")])])]):"notification"===i.msg.type?o("span",{staticClass:"msg-text notify"},[i._v(i._s(i.msg.showText))]):o("span",{staticClass:"msg-text",domProps:{innerHTML:i._s(i.msg.showText)}}),"fail"===i.msg.status?o("span",{staticClass:"msg-failed"},[o("i",{staticClass:"weui-icon-warn"})]):i._e(),0<=i.teamMsgUnRead?o("a",{staticClass:"msg-unread",attrs:{href:"#/msgReceiptDetail/"+i.msg.to+"-"+i.msg.idServer}},[i._v(i._s(0<i.teamMsgUnRead?i.teamMsgUnRead+"人未读":"全部已读"))]):i._e()]):i._e()])},[],!1,null,null,null).exports},props:{type:String,canLoadMore:[String,Boolean],isRobot:{type:Boolean,default:function(){return!1}},msglist:{type:Array,default:function(){return[]}},userInfos:{type:Object,default:function(){return{}}},myInfo:{type:Object,default:function(){return{}}},isHistory:{type:Boolean,default:function(){return!1}}},data:function(){return{isFullImgShow:!1,msgLoadedTimer:null}},methods:{showFullImg:function(e){this.$store.dispatch("showFullscreenImg",{src:e})},msgLoaded:function(){var e=this;clearTimeout(this.msgLoadedTimer),this.msgLoadedTimer=setTimeout(function(){e.$emit("msgs-loaded")},20)}}},u=(i("47e4"),Object(l.a)(m,function(){var i=this,e=i.$createElement,o=i._self._c||e;return o("ul",{staticClass:"m-chat-list p-chat-list",attrs:{id:"chat-list"}},[i.canLoadMore?o("li",{staticClass:"u-msg item-time"},[i._v("\n    ---- 上拉加载更多 ----\n  ")]):o("li",{staticClass:"u-msg item-time"},[i._v("\n    ---- 已无更多记录 ----\n  ")]),i._l(i.msglist,function(e,t){return o("chat-item",{key:e.idClient||t,attrs:{type:i.type,rawMsg:e,isRobot:i.isRobot,userInfos:i.userInfos,myInfo:i.myInfo,isHistory:i.isHistory},on:{"msg-loaded":i.msgLoaded}})})],2)},[],!1,null,null,null));t.a=u.exports}}]);