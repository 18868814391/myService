(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c12077d2"],{"003e":function(t,e,o){},"0421":function(t,e,o){},"615c":function(t,e,o){"use strict";var i=o("0421"),s=o.n(i);s.a},"6e4e":function(t,e,o){"use strict";var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"m-chat-editor",on:{click:t.hideRobotList}},[o("chat-emoji",{directives:[{name:"show",rawName:"v-show",value:t.isEmojiShown,expression:"isEmojiShown"}],attrs:{type:t.type,scene:t.scene,to:t.to},on:{"add-emoji":t.addEmoji,"hide-emoji":t.hideEmoji}}),o("van-cell-group",{directives:[{name:"show",rawName:"v-show",value:t.isRobotListShown,expression:"isRobotListShown"}],staticClass:"m-chat-emoji m-chat-robot"},t._l(t.robotslist,function(e){return o("van-cell",{key:e.account,attrs:{title:e.nick},nativeOn:{click:function(o){return t.chooseRobot(e)}}},[o("img",{staticClass:"icon u-circle",attrs:{slot:"icon",width:"20",height:"20",src:e.avatar},slot:"icon"})])}),1),o("div",{staticClass:"m-chat-editor-main",class:{robot:t.isRobot}},[o("span",{staticClass:"u-editor-input"},[t.sendTxt?o("textarea",{directives:[{name:"model",rawName:"v-model",value:t.msgToSent,expression:"msgToSent"}],domProps:{value:t.msgToSent},on:{focus:t.onInputFocus,input:function(e){e.target.composing||(t.msgToSent=e.target.value)}}}):t._e(),t.supportTouch&&!t.sendTxt?o("i",{directives:[{name:"touch",rawName:"v-touch:swipeup",value:t.cancelRecord,expression:"cancelRecord",arg:"swipeup"}],staticClass:"u-btn-record",class:{recording:t.recording,disabled:t.recordDisable},on:{touchstart:function(e){return e.preventDefault(),t.toRecord(e)},touchend:function(e){return e.preventDefault(),t.sendRecordMsg(e)}}},[t.recording?o("b",[t._v("松开结束")]):o("b",[t._v("按下说话")]),t.recording?o("a",{staticClass:"u-record-time",attrs:{id:"recordTime"}},[t._v("00:00")]):t._e()]):t._e(),t.supportTouch||t.sendTxt?t._e():o("i",{staticClass:"u-btn-record",class:{recording:t.recording,disabled:t.recordDisable},on:{click:function(e){return e.stopPropagation(),t.siwtchRecord(e)}}},[t.recording?o("b",[t._v("点击发送")]):o("b",[t._v("点击说话")]),t.recording?o("a",{staticClass:"u-record-time with-close-btn",attrs:{id:"recordTime"},on:{click:function(e){return e.stopPropagation(),t.cancelRecord(e)}}},[t._v("00:00")]):t._e()])]),o("span",{staticClass:"u-editor-icons ChatEditor-rightBox"},[t.sendTxt?o("span",{staticClass:"u-editor-icon",on:{click:function(e){return e.stopPropagation(),t.swicthMsgType(e)}}},[o("i",{staticClass:"u-icon-img"},[o("img",{attrs:{src:t.icon5}})])]):o("span",{staticClass:"u-editor-icon",on:{click:function(e){return e.stopPropagation(),t.swicthMsgType(e)}}},[o("i",{staticClass:"u-icon-img"},[o("img",{attrs:{src:t.icon4}})])]),t.isRobot?t._e():o("span",{staticClass:"u-editor-icon",on:{click:function(e){return e.stopPropagation(),t.showEmoji(e)}}},[o("i",{staticClass:"u-icon-img"},[o("img",{attrs:{src:t.icon1}})])]),t.isRobot?t._e():o("span",{staticClass:"u-editor-icon"},[o("i",{staticClass:"u-icon-img"},[o("img",{attrs:{src:t.icon2}})]),o("input",{ref:"fileToSent",attrs:{type:"file"},on:{change:t.sendFileMsg}})]),t.isRobot||t.advancedTeam?t._e():o("span",{staticClass:"u-editor-icon",on:{click:function(e){return e.stopPropagation(),t.sendPlayMsg(e)}}},[o("i",{staticClass:"u-icon-img"},[o("img",{attrs:{src:t.icon3}})])]),t.advancedTeam?o("span",{staticClass:"u-editor-send u-editor-receipt",on:{click:t.turnToMsgReceipt}},[t._v("回执")]):t._e(),o("span",{staticClass:"u-editor-send",on:{click:t.sendTextMsg}},[t._v("发 送")])])])],1)},s=[],n=(o("a481"),o("4917"),o("bd86")),r=(o("7f7f"),function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"m-chat-emoji"},[o("div",{staticClass:"emoji-content"},[o("div",{staticClass:"cnt"},t._l(t.currEmoji.list,function(e){return o("span",{staticClass:"emoji-item",class:{"pinup-item":"pinup"===e.type},on:{click:function(o){return o.stopPropagation(),t.selectEmoji(e)}}},[o("img",{attrs:{src:e.img}})])}),0)]),o("div",{staticClass:"emoji-channel"},[t._l(t.emoji,function(e){return o("span",{staticClass:"emoji-album",class:{active:e.name==t.currAlbum},on:{click:function(o){return o.stopPropagation(),t.selectAlbum(e)}}},[o("img",{attrs:{src:e.album}})])}),t._l(t.pinup,function(e){return"session"===t.type?o("span",{staticClass:"emoji-album",class:{active:e.name==t.currAlbum},on:{click:function(o){return o.stopPropagation(),t.selectAlbum(e)}}},[o("img",{attrs:{src:e.album}})]):t._e()})],2)])}),c=[],a=o("a850");function d(t,e){var o={};for(var i in e){var s=e[i],n=[];for(var r in s)n.push({type:t,name:i,key:r,img:s[r].img});n.length>0&&(o[i]={type:t,name:i,list:n,album:n[0].img})}return o}var u,h={props:{type:String,scene:String,to:String},data:function(){return{currType:"emoji",currAlbum:"emoji"}},computed:{emoji:function(){return d("emoji",a["a"].emojiList)},pinup:function(){return d("pinup",a["a"].pinupList)},currEmoji:function(){return"emoji"===this.currType?this.emoji[this.currAlbum]:"pinup"===this.currType?this.pinup[this.currAlbum]:[]}},methods:{selectAlbum:function(t){this.currType=t.type,this.currAlbum=t.name},selectEmoji:function(t){"emoji"===this.currType?this.$emit("add-emoji",t.key):"pinup"===this.currType&&("session"===this.type?this.$store.dispatch("sendMsg",{type:"custom",scene:this.scene,to:this.to,pushContent:"[贴图表情]",content:{type:3,data:{catalog:this.currAlbum,chartlet:t.key}}}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomMsg",{type:"custom",pushContent:"[贴图表情]",content:{type:3,data:{catalog:this.currAlbum,chartlet:t.key}}}),this.$emit("hide-emoji"))}}},l=h,m=(o("615c"),o("2877")),p=Object(m["a"])(l,r,c,!1,null,null,null),g=p.exports,f=(o("ed08"),o("f61f")),b=o("5def"),T=o("b970"),v={components:(u={ChatEmoji:g},Object(n["a"])(u,T["b"].name,T["b"]),Object(n["a"])(u,T["c"].name,T["c"]),u),updated:function(){var t=this;window.document.body.addEventListener("click",function(){t.isEmojiShown=!1})},props:{type:String,scene:String,to:String,isRobot:{type:Boolean,default:function(){return!1}},invalid:{type:Boolean,default:!1},invalidHint:{type:String,default:"您无权限发送消息"},advancedTeam:{type:Boolean,default:!1}},watch:{continueRobotAccid:function(t,e){t&&this.robotInfos[t]&&(this.msgToSent="@".concat(this.robotInfos[t].nick," ")),this.$store.dispatch("continueRobotMsg","")},msgToSent:function(t,e){if(!this.isRobot){var o=this.msgToSent.indexOf("@");o>=0&&o===this.msgToSent.length-1?this.robotslist&&this.robotslist.length>0&&(this.isRobotListShown=!0):!0===this.isRobotListShown&&(this.isRobotListShown=!1)}}},data:function(){var t={isEmojiShown:!1,isRobotListShown:!1,msgToSent:"",icon1:"".concat(f["a"].resourceUrl,"/im/chat-editor-1.png"),icon2:"".concat(f["a"].resourceUrl,"/im/chat-editor-2.png"),icon3:"".concat(f["a"].resourceUrl,"/im/chat-editor-3.png"),icon4:"https://yx-web-nosdn.netease.im/quickhtml%2Fassets%2Fyunxin%2Fdefault%2Fchat-editor-keyboard.png",icon5:"https://yx-web-nosdn.netease.im/quickhtml%2Fassets%2Fyunxin%2Fdefault%2Fchat-editor-record.png",sendTxt:!0,recording:!1,recordDisable:!1,toRecordCount:0,recordTime:0,$recordTime:null,recordTimeout:"",recorder:null,audioContext:null};try{t.audioContext=new window.AudioContext}catch(e){t.recordDisable=!0,console.error(e)}return t},computed:{continueRobotAccid:function(){return this.$store.state.continueRobotAccid},robotslist:function(){return this.$store.state.robotslist},robotInfos:function(){return this.$store.state.robotInfos},robotInfosByNick:function(){return this.$store.state.robotInfosByNick},supportTouch:function(){return"ontouchend"in document&&"ontouchstart"in document&&"ontouchmove"in document}},methods:{sendTextMsg:function(){if(this.invalid)this.$toast(this.invalidHint);else if(/^\s*$/.test(this.msgToSent))this.$vux.alert.show({title:"请不要发送空消息"});else if(this.msgToSent.length>800)this.$vux.alert.show({title:"请不要超过800个字"});else{if(this.msgToSent=this.msgToSent.trim(),"session"===this.type)if(this.isRobot)this.$store.dispatch("sendRobotMsg",{type:"text",scene:this.scene,to:this.to,robotAccid:this.to,content:this.msgToSent,body:this.msgToSent});else{var t="",e="",o=this.msgToSent.match(/@[^\s@$]+/g);if(o)for(var i=0;i<o.length;i++){var s=o[i].replace("@","");if(this.robotInfosByNick[s]){t=this.robotInfosByNick[s].account,e=(this.msgToSent+"").replace(o[i],"").trim();break}}t?e?this.$store.dispatch("sendRobotMsg",{type:"text",scene:this.scene,to:this.to,robotAccid:t,content:e,body:this.msgToSent}):this.$store.dispatch("sendRobotMsg",{type:"welcome",scene:this.scene,to:this.to,robotAccid:t,body:this.msgToSent}):this.$store.dispatch("sendMsg",{type:"text",scene:this.scene,to:this.to,text:this.msgToSent})}else if("chatroom"===this.type){var n="",r="",c=this.msgToSent.match(/@[^\s@$]+/g);if(c)for(var a=0;a<c.length;a++){var d=c[a].replace("@","");if(this.robotInfosByNick[d]){n=this.robotInfosByNick[d].account,r=(this.msgToSent+"").replace(c[a],"").trim();break}}n?r?this.$store.dispatch("sendChatroomRobotMsg",{type:"text",robotAccid:n,content:r,body:this.msgToSent}):this.$store.dispatch("sendChatroomRobotMsg",{type:"welcome",robotAccid:n,body:this.msgToSent}):this.$store.dispatch("sendChatroomMsg",{type:"text",text:this.msgToSent})}this.msgToSent=""}},sendPlayMsg:function(){this.invalid?this.$toast(this.invalidHint):"session"===this.type?this.$store.dispatch("sendMsg",{type:"custom",scene:this.scene,to:this.to,pushContent:"[猜拳]",content:{type:1,data:{value:Math.ceil(3*Math.random())}}}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomMsg",{type:"custom",pushContent:"[猜拳]",content:{type:1,data:{value:Math.ceil(3*Math.random())}}})},sendFileMsg:function(){if(this.invalid)this.$toast(this.invalidHint);else{var t=this.$refs.fileToSent;t.value&&("session"===this.type?this.$store.dispatch("sendFileMsg",{scene:this.scene,to:this.to,fileInput:t}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomFileMsg",{fileInput:t}))}},showEmoji:function(){this.isEmojiShown=!0},hideEmoji:function(){this.isEmojiShown=!1},addEmoji:function(t){this.msgToSent+=t,this.hideEmoji()},chooseRobot:function(t){if(t&&t.account){var e=this.msgToSent.length;0!==e&&"@"===this.msgToSent[e-1]||(this.msgToSent+="@"+t.nick+" "),this.msgToSent+=t.nick+" "}},hideRobotList:function(){this.isRobotListShown=!1},onInputFocus:function(t){setTimeout(function(){t.target.scrollIntoView(),b["a"].scrollChatListDown()},200)},turnToMsgReceipt:function(){this.invalid?this.$toast(this.invalidHint):location="#/teamSendMsgReceipt/".concat(this.to)},swicthMsgType:function(){this.sendTxt=!this.sendTxt},toRecord:function(){var t=this;if(t.toRecordCount++,window.stopPlayAudio&&window.stopPlayAudio(),"http:"!==location.protocol){if(!t.recording)if(t.toRecordCount>1&&!t.recorder&&(t.recordDisable=!0),!t.recordDisable&&t.audioContext&&window.AudioContext&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)if(t.recorder)t.recorder.record(),t.resumeAudioContext();else{var e=function(){t.recordDisable=!0,t.$toast("当前浏览器不支持录音")};try{navigator.mediaDevices.getUserMedia({audio:!0}).then(function(o){var i;try{i=t.audioContext.createMediaStreamSource(o),t.recorder=new Recorder(i),t.recorder.record(),t.resumeAudioContext(),t.recorder||e()}catch(s){e()}}).catch(function(e){t.$toast("没有权限获取麦克风"),t.recordDisable=!0,console.log("No live audio input: "+e,e.name+": "+e.message)})}catch(o){e()}}else t.$toast("当前浏览器不支持录音")}else t.$toast("请使用https协议")},runRecorderTime:function(){var t=this;this.recorder&&(this.recording=!0,this.recordTime=0,setTimeout(function(){t.$recordTime=document.getElementById("recordTime")},800),this.recordTimeout=setTimeout(this.runRecordDuration.bind(this),1e3))},resumeAudioContext:function(){var t=this;this.audioContext&&~this.audioContext.state.indexOf("suspend")?this.audioContext.resume().then(function(){console.log("audioContext suspend state resume"),t.recorder.record(),t.runRecorderTime()}):this.runRecorderTime()},runRecordDuration:function(){this.recordTimeout=setTimeout(this.runRecordDuration.bind(this),1e3),this.recordTime++,this.recordTime>=60&&(clearTimeout(this.recordTimeout),this.sendRecord()),this.$recordTime.innerText="00:"+(this.recordTime>9?this.recordTime:"0"+this.recordTime)},siwtchRecord:function(){this.recording?this.sendRecordMsg():this.toRecord()},cancelRecord:function(){this.recording&&(this.recording=!1,clearTimeout(this.recordTimeout),this.$recordTime&&(this.$recordTime.innerText="00:00"),this.recorder.stop(),this.recorder.clear())},sendRecordMsg:function(){setTimeout(this.sendRecord,500)},sendRecord:function(){var t=this;if(this.recording){if(clearTimeout(this.recordTimeout),this.recordTime<2)return this.$toast("语音消息最短2s"),void this.cancelRecord();this.recording=!1,this.$recordTime.innerText="00:00",this.recorder.stop(),this.recorder.exportWAV(function(e){t.$store.dispatch("showLoading"),t.$store.dispatch("sendFileMsg",{scene:t.scene,to:t.to,type:"audio",blob:e,uploadprogress:function(e){console.log("文件总大小: "+e.total+"bytes"),console.log("已经上传的大小: "+e.loaded+"bytes"),console.log("上传进度: "+e.percentage),console.log("上传进度文本: "+e.percentageText),100===e.percentage&&t.$store.dispatch("hideLoading")},uploaderror:function(){console&&console.log("上传失败")},uploaddone:function(t,e){console.log(t)}})}),this.recorder.clear()}}}},y=v,w=(o("6ef0"),Object(m["a"])(y,i,s,!1,null,null,null));e["a"]=w.exports},"6ef0":function(t,e,o){"use strict";var i=o("003e"),s=o.n(i);s.a}}]);
//# sourceMappingURL=chunk-c12077d2.0d87ed25.js.map