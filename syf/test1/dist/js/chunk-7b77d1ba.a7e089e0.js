(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b77d1ba"],{"2e3a":function(t,s,e){"use strict";e.r(s);var a,n=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"chat-page"},[e("div",{staticClass:"chat-page-head"},[t._v("\n    当前在线人数"+t._s(t.num)+"\n    ")]),e("div",{staticClass:"chat-page-body",attrs:{id:"msg_box"}},[t._l(t.histortist,function(s,a){return e("div",{key:a,staticClass:"chatMsg"},[s.adm!=t.admin?e("div",{staticClass:"chatMsg-t1"},[t._v(t._s(s.Thename)+"说：")]):t._e(),s.adm!=t.admin?e("div",{staticClass:"chatMsg-t2"},[t._v(t._s(s.updataTime))]):t._e(),s.adm!=t.admin?e("div",{staticClass:"chatMsg-t3"},[t._v(t._s(s.content))]):t._e(),s.adm==t.admin?e("div",{staticClass:"chatMsg-t1 al gb"},[t._v(t._s(s.Thename)+"说：")]):t._e(),s.adm==t.admin?e("div",{staticClass:"chatMsg-t2 al gb"},[t._v(t._s(s.updataTime))]):t._e(),s.adm==t.admin?e("div",{staticClass:"chatMsg-t3 al gb"},[t._v(t._s(s.content))]):t._e()])}),e("div",{staticClass:"historyRecord"},[t._v("————历史纪录————")]),t._l(t.chatList,function(s,a){return e("div",{key:a,staticClass:"chatMsg"},[s.adm!=t.admin?e("div",{staticClass:"chatMsg-t1"},[t._v(t._s(s.Thename)+"说：")]):t._e(),s.adm!=t.admin?e("div",{staticClass:"chatMsg-t2"},[t._v(t._s(s.updataTime))]):t._e(),s.adm!=t.admin?e("div",{staticClass:"chatMsg-t3"},[s.content?e("span",[t._v(t._s(s.content))]):t._e(),s.voice?e("span",{on:{click:function(e){return t.startVoice(s.voice)}}},[t._v("[点击播放语音]")]):t._e()]):t._e(),s.adm==t.admin?e("div",{staticClass:"chatMsg-t1 al gb"},[t._v(t._s(s.Thename)+"说：")]):t._e(),s.adm==t.admin?e("div",{staticClass:"chatMsg-t2 al gb"},[t._v(t._s(s.updataTime))]):t._e(),s.adm==t.admin?e("div",{staticClass:"chatMsg-t3 al gb"},[s.content?e("span",[t._v(t._s(s.content))]):t._e(),s.voice?e("span",{on:{click:function(e){return t.startVoice(s.voice)}}},[t._v("[点击播放语音]")]):t._e()]):t._e()])})],2),e("div",{staticClass:"chat-page-bottom"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.con,expression:"con"}],attrs:{type:"text",name:"",id:""},domProps:{value:t.con},on:{input:function(s){s.target.composing||(t.con=s.target.value)}}}),e("div",{staticClass:"sendop"},[e("div",{staticClass:"sendop-b1"},[e("button",{on:{click:function(s){t.show=!t.show}}},[t._v("颜艺")]),e("button",{on:{click:t.startRecord}},[t._v(t._s(t.isRecording?"录音中...":"点击录音"))])]),e("button",{on:{click:t.send}},[t._v("发送")])])]),e("van-popup",{attrs:{position:"bottom"},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}},[e("div",{staticClass:"emojBox"},t._l(t.emoji,function(s,a){return e("div",{key:a,staticClass:"emojBox-items",on:{click:function(e){return t.selEmoj(s)}}},[t._v("\n        "+t._s(s)+"\n      ")])}),0)])],1)},o=[],i=e("f499"),c=e.n(i),d=e("bd86"),r=(e("7f7f"),e("b970")),l=e("365c"),m=e("5f87"),u=e("c1df"),h=e.n(u),v=e("18a0"),g=e.n(v),p={components:(a={},Object(d["a"])(a,r["o"].name,r["o"]),Object(d["a"])(a,r["i"].name,r["i"]),Object(d["a"])(a,r["d"].name,r["d"]),a),data:function(){return{show:!1,emoji:["w(ﾟДﾟ)w","ヽ(✿ﾟ▽ﾟ)ノ","(๑•̀ㅂ•́)و✧","(⊙﹏⊙)","┗|｀O′|┛","φ(≧ω≦*)♪","凸(艹皿艹 )","╰(*°▽°*)╯","（´Д`）","(#`O′)","(＠_＠;)","(ー`´ー)"],num:"",histortist:[],chatList:[],admin:Object(m["b"])(),Thename:Object(m["a"])(),con:"",ws:null,hub:"",noAdm:"",isRecording:!1,localId:"",serverId:"",openVoice:"",signature:""}},beforeRouteLeave:function(t,s,e){this.ws.close(),e()},created:function(){var t=this;if(!Object(m["b"])()){Object(r["o"])("您尚未登陆，将随机分配您的用户名");var s=(new Date).valueOf();console.log(String(s)),this.noAdm="匿名用户"+String(s).substr(7,10),console.log(this.noAdm),this.admin=this.noAdm,this.Thename=this.noAdm}t.getlatest(),this.ws=new WebSocket("wss://www.shenyifan.top/socket/"),this.ws.onopen=function(){console.log("握手成功")},this.ws.onmessage=function(s){console.log("message:"+s.data),JSON.parse(s.data).content||JSON.parse(s.data).voice?(t.chatList.push(JSON.parse(s.data)),t.$nextTick(function(){var t=document.getElementById("msg_box");t.scrollTop=t.scrollHeight})):t.num=s.data},this.ws.onerror=function(){Object(r["o"])("socket连接以断开，请刷新页面"),console.log("error")},setTimeout(function(){var s=h()().format("MMMM Do YYYY, h:mm:ss a"),e={adm:t.admin,Thename:t.Thename,content:t.Thename+"加入了聊天室",updataTime:s};t.ws.send(c()(e))},2e3)},mounted:function(){var t=this;t.signature=sessionStorage.getItem("wxsignature"),t.signature&&g.a.config({debug:!1,appId:"wx3352249676449b29",timestamp:"1414587457",nonceStr:"syf",signature:t.signature,jsApiList:["checkJsApi","getLocation","scanQRCode","openLocation","startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice"]}),g.a.onVoiceRecordEnd({complete:function(s){t.localId=s.localId,g.a.uploadVoice({localId:t.localId,isShowProgressTips:1,success:function(s){t.serverId=s.serverId,r["d"].confirm({title:"提示",message:"音频上传好了，是否发送呢？"}).then(function(){var s=h()().format("MMMM Do YYYY, h:mm:ss a"),e={adm:t.admin,Thename:t.Thename,content:"",updataTime:s,voice:t.serverId};t.ws.send(c()(e))}).catch(function(){})}})}})},methods:{send:function(){var t=this;if(t.isRecording)t.endAndSend();else{if(!this.con)return Object(r["o"])("请输入点什么"),!1;var s=h()().format("MMMM Do YYYY, h:mm:ss a"),e={adm:t.admin,Thename:t.Thename,content:String(t.con),updataTime:s};this.ws.send(c()(e)),this.con=""}},getlatest:function(){var t=this;Object(l["x"])({}).then(function(s){console.log(s),t.histortist=s.data.errmsg,t.histortist.reverse(),console.log(t.histortist)}).catch(function(t){})},selEmoj:function(t){this.con=this.con+t,this.show=!1},startRecord:function(){var t=this;this.isRecording?t.endAndSend():(this.isRecording=!0,g.a.startRecord())},startVoice:function(t){var s=this;g.a.downloadVoice({serverId:t,isShowProgressTips:1,success:function(t){s.openVoice=t.localId,g.a.playVoice({localId:s.openVoice})}})},endAndSend:function(){var t=this;this.isRecording=!1,g.a.stopRecord({success:function(s){t.localId=s.localId,g.a.uploadVoice({localId:t.localId,isShowProgressTips:1,success:function(s){t.serverId=s.serverId,r["d"].confirm({title:"提示",message:"音频上传好了，是否发送呢？"}).then(function(){var s=h()().format("MMMM Do YYYY, h:mm:ss a"),e={adm:t.admin,Thename:t.Thename,content:"",updataTime:s,voice:t.serverId};t.ws.send(c()(e))}).catch(function(){})}})}})}}},f=p,_=(e("50dc"),e("2877")),b=Object(_["a"])(f,n,o,!1,null,null,null);s["default"]=b.exports},"50dc":function(t,s,e){"use strict";var a=e("f39a"),n=e.n(a);n.a},f39a:function(t,s,e){}}]);
//# sourceMappingURL=chunk-7b77d1ba.a7e089e0.js.map